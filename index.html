<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criteryon</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0A0A0A;
            color: #FFFFFF;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
        }
        h1 { color: #F5B342; font-size: 28px; }
        .btn {
            padding: 10px 20px;
            background: #F5B342;
            color: #0A0A0A;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-left: 10px;
        }
        .btn:hover { background: #FFD166; }
        .btn-secondary { background: #333; color: #FFF; }
        .btn-secondary:hover { background: #444; }
        .btn-success { background: #00E396; padding: 8px 16px; font-size: 13px; }
        .btn-danger { background: #FF4560; padding: 8px 16px; font-size: 13px; color: #FFF; }
        .btn-warning { background: #FEB019; padding: 8px 16px; font-size: 13px; color: #000; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card {
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
        }
        .card-title {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: #F5B342;
            margin-bottom: 5px;
        }
        .card-subtitle { font-size: 14px; color: #666; }
        .success { color: #00E396; }
        .danger { color: #FF4560; }
        .warning { color: #FEB019; }
        .section { margin-bottom: 30px; }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #F5B342;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        .alert-success { background: rgba(0, 227, 150, 0.1); border-color: #00E396; color: #00E396; }
        .alert-warning { background: rgba(254, 176, 25, 0.1); border-color: #FEB019; color: #FEB019; }
        .alert-danger { background: rgba(255, 69, 96, 0.1); border-color: #FF4560; color: #FF4560; }
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block;
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            background: #0A0A0A;
            border: 1px solid #333;
            border-radius: 8px;
            color: #FFF;
            font-size: 14px;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #F5B342;
        }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th {
            background: #1A1A1A;
            padding: 12px;
            text-align: left;
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            border-bottom: 1px solid #333;
        }
        td {
            padding: 15px 12px;
            border-bottom: 1px solid #222;
        }
        tr:hover { background: #1A1A1A; }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-pending { background: rgba(254, 176, 25, 0.2); color: #FEB019; }
        .badge-win { background: rgba(0, 227, 150, 0.2); color: #00E396; }
        .badge-loss { background: rgba(255, 69, 96, 0.2); color: #FF4560; }
        .badge-cashout { background: rgba(245, 179, 66, 0.2); color: #F5B342; }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .tab {
            padding: 10px 20px;
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            font-size: 14px;
        }
        .tab:hover { background: #222; }
        .tab.active { background: #F5B342; color: #0A0A0A; border-color: #F5B342; }
        .tab.high-volume::after { content: ' üî•'; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-title { font-size: 24px; margin-bottom: 20px; color: #F5B342; }
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        .suggestion-box {
            background: rgba(245, 179, 66, 0.1);
            border: 2px dashed rgba(245, 179, 66, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .suggestion-title {
            font-size: 14px;
            font-weight: 600;
            color: #F5B342;
            margin-bottom: 15px;
        }
        .suggestion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .suggestion-item { text-align: center; }
        .suggestion-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .suggestion-value {
            font-size: 20px;
            font-weight: 700;
            color: #F5B342;
        }
        .bar {
            height: 8px;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .bar-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        .bar-available { background: linear-gradient(90deg, #00E396, #00C48C); }
        .bar-invested { background: linear-gradient(90deg, #FEB019, #D4941F); }
        .bar-profit { background: linear-gradient(90deg, #00E396, #00C48C); }
        .bar-loss { background: linear-gradient(90deg, #FF4560, #DC143C); }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        .debug {
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>CRITERYON</h1>
                
            </div>
            <div>
                <button class="btn btn-secondary" onclick="openConfigModal()">‚öôÔ∏è Config</button>
                <button class="btn btn-secondary" onclick="exportData()">üì• Exportar</button>
                <button class="btn" onclick="manualSave()">üíæ Salvar</button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid">
            <div class="card">
                <div class="card-title">üí∞ Carteira Total</div>
                <div class="card-value" id="totalBankroll">R$ 0,00</div>
                <div class="card-subtitle" id="bankrollChange">-</div>
            </div>
            <div class="card">
                <div class="card-title">üíµ Saldo Dispon√≠vel</div>
                <div class="card-value" id="availableBalance">R$ 0,00</div>
                <div class="card-subtitle" id="availablePercent">-</div>
            </div>
            <div class="card">
                <div class="card-title">‚è≥ Valor Investido</div>
                <div class="card-value warning" id="investedAmount">R$ 0,00</div>
                <div class="card-subtitle" id="investedPercent">-</div>
            </div>
            <div class="card">
                <div class="card-title">üìà Lucro Total</div>
                <div class="card-value success" id="totalProfit">R$ 0,00</div>
                <div class="card-subtitle" id="profitCount">-</div>
            </div>
            <div class="card">
                <div class="card-title">üìâ Preju√≠zo Total</div>
                <div class="card-value danger" id="totalLoss">R$ 0,00</div>
                <div class="card-subtitle" id="lossCount">-</div>
            </div>
            <div class="card">
                <div class="card-title">üéØ Win Rate Real</div>
                <div class="card-value" id="actualWinRate">0%</div>
                <div class="card-subtitle" id="winRateHint">-</div>
            </div>
        </div>

        <!-- Distribution Bars -->
        <div class="section">
            <div class="section-title">üìä Distribui√ß√£o da Carteira</div>
            <div class="card">
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 13px; color: #999;">Dispon√≠vel</span>
                        <span style="font-size: 13px; color: #999;" id="barAvailableLabel">R$ 0 (0%)</span>
                    </div>
                    <div class="bar"><div class="bar-fill bar-available" id="barAvailable" style="width: 0%"></div></div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 13px; color: #999;">Investido</span>
                        <span style="font-size: 13px; color: #999;" id="barInvestedLabel">R$ 0 (0%)</span>
                    </div>
                    <div class="bar"><div class="bar-fill bar-invested" id="barInvested" style="width: 0%"></div></div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 13px; color: #999;">Lucro Acumulado</span>
                        <span style="font-size: 13px; color: #999;" id="barProfitLabel">R$ 0</span>
                    </div>
                    <div class="bar"><div class="bar-fill bar-profit" id="barProfit" style="width: 0%"></div></div>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 13px; color: #999;">Preju√≠zo Acumulado</span>
                        <span style="font-size: 13px; color: #999;" id="barLossLabel">R$ 0</span>
                    </div>
                    <div class="bar"><div class="bar-fill bar-loss" id="barLoss" style="width: 0%"></div></div>
                </div>
            </div>
        </div>

        <!-- AI Suggestions -->
        <div class="section">
            <div class="section-title">ü§ñ An√°lise Inteligente & Sugest√µes</div>
            <div class="grid">
                <div class="card">
                    <div class="card-title">üíµ Stake Recomendado</div>
                    <div class="card-value" id="suggestedStake">R$ 0,00</div>
                    <div class="card-subtitle" id="stakePercent">-</div>
                </div>
                <div class="card">
                    <div class="card-title">üéØ Odd Ideal</div>
                    <div class="card-value" id="idealOdd">0.00</div>
                    <div class="card-subtitle" id="oddRange">-</div>
                </div>
                <div class="card">
                    <div class="card-title">üìä Apostas Recomendadas Hoje</div>
                    <div class="card-value" id="maxBetsToday">0</div>
                    <div class="card-subtitle" id="dayType">-</div>
                </div>
                <div class="card">
                    <div class="card-title">üé≤ Confian√ßa</div>
                    <div class="card-value" id="confidenceLevel">-</div>
                    <div class="card-subtitle" id="strategyInfo">-</div>
                </div>
            </div>
            <div id="aiAlerts"></div>
        </div>

        <!-- Tabs -->
        <div class="section">
            <div class="section-title">üìÖ Apostas por Dia</div>
            <div class="tabs" id="tabButtons"></div>
            <div class="card" id="tabContent"></div>
        </div>

        <!-- Debug Info -->
        <div class="debug" id="debugInfo" style="display: none;"></div>
    </div>

    <!-- Config Modal -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-title">‚öôÔ∏è Configura√ß√µes</div>
            <div class="form-row">
                <div class="form-group">
                    <label>Carteira Total (R$)</label>
                    <input type="number" id="bankrollInput" step="0.01" min="1">
                </div>
                <div class="form-group">
                    <label>Win Rate Estimado (%)</label>
                    <input type="number" id="winRateInput" step="1" min="30" max="80">
                    <small id="winRateHintConfig" style="color: #666; font-size: 11px;"></small>
                </div>
            </div>
            <div class="form-group">
                <label>Estrat√©gia</label>
                <select id="strategySelect">
                    <option value="kelly">Kelly Criterion</option>
                    <option value="kelly_fractional">Kelly Fracion√°rio (1/4)</option>
                    <option value="fibonacci">Fibonacci Recovery</option>
                    <option value="percentage">Percentage Staking</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeConfigModal()">Cancelar</button>
                <button class="btn" onclick="updateConfig()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Cashout Modal -->
    <div class="modal" id="cashoutModal">
        <div class="modal-content">
            <div class="modal-title">üí∞ Cashout</div>
            <div class="form-group">
                <label>Resultado</label>
                <select id="cashoutResult">
                    <option value="win">‚úÖ Ganhou</option>
                    <option value="loss">‚ùå Perdeu</option>
                </select>
            </div>
            <div class="form-group">
                <label>Valor Recebido (R$)</label>
                <input type="number" id="cashoutAmount" step="0.01" min="0">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeCashoutModal()">Cancelar</button>
                <button class="btn" onclick="confirmCashout()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-title">üì§ Importar Backup</div>
            <div class="form-group">
                <label>Cole o JSON:</label>
                <textarea id="importData" rows="10" style="width: 100%; background: #0A0A0A; border: 1px solid #333; border-radius: 8px; padding: 12px; color: #FFF; font-family: monospace;"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeImportModal()">Cancelar</button>
                <button class="btn" onclick="importData()">Importar</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // BACKEND - L√ìGICA PRINCIPAL
        // ============================================

        // Dados de incid√™ncia de jogos por dia
        const MATCH_FREQUENCY = {
            brasil: {
                segunda: { min: 3, max: 5, label: 'Segunda' },
                terca: { min: 2, max: 3, label: 'Ter√ßa' },
                quarta: { min: 15, max: 20, label: 'Quarta' },
                quinta: { min: 15, max: 20, label: 'Quinta' },
                sexta: { min: 2, max: 5, label: 'Sexta' },
                sabado: { min: 30, max: 35, label: 'S√°bado' },
                domingo: { min: 25, max: 30, label: 'Domingo' }
            }
        };

        // Configura√ß√£o global
        let config = {
            bankroll: 20,
            initialBankroll: 20,
            availableBalance: 20,
            strategy: 'kelly',
            estimatedWinRate: 55,
            fibonacciIndex: 0,
            lastSave: null
        };

        // Estrat√©gias de gest√£o de banca
        const strategies = {
            kelly: {
                name: 'Kelly Criterion',
                description: 'F√≥rmula matem√°tica que maximiza crescimento',
                calculate: (bankroll, odd, winRate) => {
                    const p = winRate / 100;
                    const q = 1 - p;
                    const b = odd - 1;
                    const kelly = (p * b - q) / b;
                    // Limitar a 25% para seguran√ßa
                    return Math.max(0, Math.min(0.25, kelly)) * bankroll;
                }
            },
            kelly_fractional: {
                name: 'Kelly Fracion√°rio (1/4)',
                description: 'Kelly reduzido para menor volatilidade',
                calculate: (bankroll, odd, winRate) => {
                    const fullKelly = strategies.kelly.calculate(bankroll, odd, winRate);
                    return fullKelly * 0.25;
                }
            },
            fibonacci: {
                name: 'Fibonacci Recovery',
                description: 'Progress√£o de Fibonacci para recupera√ß√£o',
                calculate: (bankroll, odd, winRate, fibIndex) => {
                    const sequence = [1, 1, 2, 3, 5, 8, 13, 21];
                    const baseUnit = bankroll * 0.02; // 2% como unidade base
                    return baseUnit * (sequence[fibIndex] || 1);
                }
            },
            percentage: {
                name: 'Percentage Staking',
                description: 'Percentual fixo da banca',
                calculate: (bankroll, odd, winRate) => {
                    // Percentual varia com win rate
                    const percent = winRate >= 60 ? 0.05 : winRate >= 55 ? 0.04 : 0.03;
                    return bankroll * percent;
                }
            }
        };

        // Dados de apostas por dia
        let bettingData = {};
        let currentTab = null;
        let currentCashoutBetIndex = null;

        // ============================================
        // FUN√á√ïES DE AN√ÅLISE E C√ÅLCULO
        // ============================================

        /**
         * Retorna o dia da semana de uma data
         */
        function getDayOfWeek(dateStr) {
            const days = ['domingo', 'segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado'];
            const date = new Date(dateStr + 'T12:00:00');
            return days[date.getDay()];
        }

        /**
         * Retorna o n√∫mero m√°ximo de apostas recomendadas para um dia
         */
        function getMaxBetsForDay(dateStr) {
            const dayName = getDayOfWeek(dateStr);
            const freq = MATCH_FREQUENCY.brasil[dayName];
            
            // Dias de alto volume: 5 apostas
            if (freq.min >= 15) return 5;
            // Dias de m√©dio volume: 3 apostas
            if (freq.min >= 10) return 3;
            // Dias de baixo volume: 2 apostas
            return 2;
        }

        /**
         * Verifica se √© um dia de alto volume de jogos
         */
        function isHighVolumeDay(dateStr) {
            const dayName = getDayOfWeek(dateStr);
            return MATCH_FREQUENCY.brasil[dayName].min >= 15;
        }

        /**
         * Calcula valores financeiros (investido, lucro, preju√≠zo)
         */
        function calculateFinancials() {
            let invested = 0;
            let totalProfit = 0;
            let totalLoss = 0;
            let profitCount = 0;
            let lossCount = 0;

            Object.values(bettingData).forEach(day => {
                day.entries.forEach(entry => {
                    if (entry.result === 'pending') {
                        // Apostas pendentes = valor investido
                        invested += entry.stake;
                    } else if (entry.result === 'win') {
                        // Vit√≥rias = lucro l√≠quido
                        const profit = entry.potentialReturn - entry.stake;
                        totalProfit += profit;
                        profitCount++;
                    } else if (entry.result === 'loss') {
                        // Derrotas = preju√≠zo total
                        totalLoss += entry.stake;
                        lossCount++;
                    } else if (entry.result === 'cashout-win') {
                        // Cashout com ganho
                        const profit = entry.cashoutAmount - entry.stake;
                        totalProfit += profit;
                        profitCount++;
                    } else if (entry.result === 'cashout-loss') {
                        // Cashout com perda parcial
                        const loss = entry.stake - entry.cashoutAmount;
                        totalLoss += loss;
                        lossCount++;
                    }
                });
            });

            return {
                invested,
                totalProfit,
                totalLoss,
                profitCount,
                lossCount,
                netProfit: totalProfit - totalLoss
            };
        }

        /**
         * Analisa performance hist√≥rica das apostas
         */
        function analyzePerformance() {
            let allEntries = [];
            
            // Coletar todas as apostas finalizadas
            Object.values(bettingData).forEach(day => {
                allEntries = allEntries.concat(day.entries.filter(e => e.result !== 'pending'));
            });

            if (allEntries.length === 0) return null;

            // Contar vit√≥rias e derrotas
            const wins = allEntries.filter(e => 
                e.result === 'win' || e.result === 'cashout-win'
            ).length;
            const losses = allEntries.filter(e => 
                e.result === 'loss' || e.result === 'cashout-loss'
            ).length;
            
            // Calcular win rate real
            const actualWinRate = (wins / allEntries.length) * 100;

            // Calcular sequ√™ncia atual (streak)
            let currentStreak = 0;
            let streakType = null;
            for (let i = allEntries.length - 1; i >= 0; i--) {
                const result = allEntries[i].result;
                const isWin = result === 'win' || result === 'cashout-win';
                const isLoss = result === 'loss' || result === 'cashout-loss';
                
                if (!streakType) {
                    streakType = isWin ? 'win' : 'loss';
                    currentStreak = 1;
                } else if ((streakType === 'win' && isWin) || (streakType === 'loss' && isLoss)) {
                    currentStreak++;
                } else {
                    break;
                }
            }

            // An√°lise das √∫ltimas 10 apostas
            const last10 = allEntries.slice(-10);
            const last10Wins = last10.filter(e => 
                e.result === 'win' || e.result === 'cashout-win'
            ).length;
            const last10WinRate = last10.length > 0 ? (last10Wins / last10.length) * 100 : 0;

            return {
                totalBets: allEntries.length,
                wins,
                losses,
                actualWinRate,
                currentStreak,
                streakType,
                last10WinRate
            };
        }

        /**
         * Gera sugest√µes inteligentes de apostas
         */
        function generateAISuggestions() {
            const analysis = analyzePerformance();
            const strategy = strategies[config.strategy];
            const today = getToday();
            
            // Determinar qual win rate usar
            let useWinRate = config.estimatedWinRate;
            if (analysis && analysis.totalBets >= 20) {
                // Ap√≥s 20 apostas, usa win rate real
                useWinRate = analysis.actualWinRate;
            } else if (analysis && analysis.totalBets >= 10) {
                // Entre 10-20 apostas, usa m√©dia ponderada
                useWinRate = (config.estimatedWinRate * 0.6) + (analysis.actualWinRate * 0.4);
            }

            // Calcular odds ideais baseado no win rate
            const p = useWinRate / 100;
            const minOdd = 1 / p; // Break-even odd
            const idealOdd = minOdd * 1.15; // 15% de edge
            const maxOdd = minOdd * 1.35; // 35% de edge m√°ximo

            // Determinar n√∫mero m√°ximo de apostas para hoje
            let maxBetsToday = getMaxBetsForDay(today);

            let suggestions = {
                stake: null,
                minOdd: minOdd.toFixed(2),
                idealOdd: idealOdd.toFixed(2),
                maxOdd: maxOdd.toFixed(2),
                maxBetsToday: maxBetsToday,
                confidence: 'medium',
                dayType: isHighVolumeDay(today) ? 'high' : 'low',
                useWinRate: useWinRate
            };

            // Calcular stake recomendado
            const testOdd = parseFloat(idealOdd);
            suggestions.stake = strategy.calculate(
                config.availableBalance,
                testOdd,
                useWinRate,
                config.fibonacciIndex
            );

            // Ajustes baseados em an√°lise
            if (analysis) {
                // Se win rate real est√° abaixo do estimado, reduzir stakes
                if (analysis.actualWinRate < config.estimatedWinRate - 5) {
                    suggestions.stake *= 0.7;
                    suggestions.confidence = 'low';
                    suggestions.maxBetsToday = Math.max(1, Math.floor(suggestions.maxBetsToday * 0.6));
                }

                // Losing streak: aplicar Fibonacci ou reduzir
                if (analysis.streakType === 'loss' && analysis.currentStreak >= 2) {
                    if (config.strategy === 'fibonacci') {
                        config.fibonacciIndex = Math.min(config.fibonacciIndex + 1, 7);
                    } else {
                        suggestions.stake *= 0.6;
                        suggestions.maxBetsToday = Math.max(1, Math.floor(suggestions.maxBetsToday * 0.5));
                    }
                }

                // Winning streak: aumentar levemente
                if (analysis.streakType === 'win' && analysis.currentStreak >= 3) {
                    suggestions.stake *= 1.1;
                    suggestions.confidence = 'high';
                    config.fibonacciIndex = 0; // Reset Fibonacci
                }

                // √öltimas 10 apostas ruins: PARAR
                if (analysis.last10WinRate < 40 && analysis.totalBets >= 10) {
                    suggestions.maxBetsToday = 0;
                    suggestions.confidence = 'danger';
                }
            }

            // Limites de seguran√ßa
            suggestions.stake = Math.min(suggestions.stake, config.availableBalance * 0.10); // M√°x 10%
            suggestions.stake = Math.min(suggestions.stake, config.availableBalance); // N√£o exceder dispon√≠vel

            return suggestions;
        }

        /**
         * Gera alertas inteligentes baseado na an√°lise
         */
        function generateAlerts(suggestions, analysis) {
            let alerts = [];

            // Alert de dia com alto volume
            if (suggestions.dayType === 'high') {
                const dayName = getDayOfWeek(getToday());
                const dayLabel = MATCH_FREQUENCY.brasil[dayName].label;
                alerts.push({
                    type: 'success',
                    message: `üî• Hoje √© ${dayLabel} - Dia de ALTO volume de jogos! Mais oportunidades (at√© ${suggestions.maxBetsToday} apostas).`
                });
            }

            // Alert de win rate real ativo
            if (analysis && analysis.totalBets >= 20) {
                alerts.push({
                    type: 'success',
                    message: `‚úÖ Sistema usando win rate REAL (${analysis.actualWinRate.toFixed(1)}%) ao inv√©s da estimativa (${config.estimatedWinRate}%). C√°lculos mais precisos!`
                });
            } else if (analysis && analysis.totalBets >= 10) {
                alerts.push({
                    type: 'warning',
                    message: `üîÑ Transi√ß√£o ativa: ${analysis.totalBets}/20 apostas. Sistema mesclando win rate estimado com real.`
                });
            }

            // Alert de losing streak
            if (analysis && analysis.streakType === 'loss' && analysis.currentStreak >= 3) {
                alerts.push({
                    type: 'danger',
                    message: `‚ö†Ô∏è ${analysis.currentStreak} derrotas consecutivas! ${config.strategy === 'fibonacci' ? 'Sistema Fibonacci ativado para recupera√ß√£o.' : 'Stakes reduzidos automaticamente. Seja mais seletivo!'}`
                });
            }

            // Alert de performance ruim recente
            if (analysis && analysis.last10WinRate < 40 && analysis.totalBets >= 10) {
                alerts.push({
                    type: 'danger',
                    message: `üõë ATEN√á√ÉO CR√çTICA! √öltimas 10 apostas: ${analysis.last10WinRate.toFixed(0)}% de acerto. Revise sua estrat√©gia de sele√ß√£o antes de continuar!`
                });
            }

            // Alert de valor muito investido
            const financials = calculateFinancials();
            if (financials.invested > config.availableBalance * 0.5) {
                alerts.push({
                    type: 'warning',
                    message: `‚è≥ Voc√™ tem R$ ${financials.invested.toFixed(2)} investido (${((financials.invested/config.bankroll)*100).toFixed(0)}% da carteira). Aguarde resultados das apostas pendentes.`
                });
            }

            // Alert de banca baixa
            if (config.bankroll < config.initialBankroll * 0.5) {
                alerts.push({
                    type: 'danger',
                    message: `üíî Banca caiu 50% do valor inicial. Considere parar e reavaliar sua estrat√©gia.`
                });
            }

            return alerts;
        }

        // ============================================
        // FUN√á√ïES DE MANIPULA√á√ÉO DE APOSTAS
        // ============================================

        /**
         * Adiciona uma nova aposta
         */
        function addEntry() {
            const desc = document.getElementById('entryDesc').value.trim();
            const odd = parseFloat(document.getElementById('entryOdd').value);
            const stake = parseFloat(document.getElementById('entryStake').value);
            const suggestions = generateAISuggestions();
            
            // Valida√ß√µes
            if (!desc || !odd || !stake) {
                alert('‚ö†Ô∏è Preencha todos os campos!');
                return;
            }

            if (isNaN(odd) || isNaN(stake)) {
                alert('‚ö†Ô∏è Odd e valor devem ser n√∫meros v√°lidos!');
                return;
            }

            if (stake > config.availableBalance) {
                alert(`‚ùå Saldo insuficiente! Dispon√≠vel: R$ ${config.availableBalance.toFixed(2)}`);
                return;
            }

            if (stake <= 0) {
                alert('‚ö†Ô∏è O valor da aposta deve ser maior que zero!');
                return;
            }

            if (odd < 1.01) {
                alert('‚ö†Ô∏è A odd deve ser maior que 1.01!');
                return;
            }
            
            // Aviso de odd fora da faixa recomendada
            if (odd < parseFloat(suggestions.minOdd)) {
                if (!confirm(`‚ö†Ô∏è Odd ${odd.toFixed(2)} est√° abaixo do m√≠nimo recomendado (${suggestions.minOdd}).\n\nEssa odd n√£o oferece valor matem√°tico suficiente para seu win rate.\n\nContinuar mesmo assim?`)) {
                    return;
                }
            }
            
            if (odd > parseFloat(suggestions.maxOdd)) {
                if (!confirm(`‚ö†Ô∏è Odd ${odd.toFixed(2)} est√° acima do m√°ximo recomendado (${suggestions.maxOdd}).\n\nOdds muito altas t√™m menor probabilidade de sucesso.\n\nContinuar mesmo assim?`)) {
                    return;
                }
            }
            
            // Criar aposta
            const entry = {
                description: desc,
                odd: odd,
                stake: stake,
                potentialReturn: stake * odd,
                result: 'pending',
                timestamp: new Date().toISOString(),
                strategy: config.strategy,
                suggestedStake: suggestions.stake,
                useWinRate: suggestions.useWinRate
            };
            
            // DESCONTAR DO SALDO DISPON√çVEL
            config.availableBalance -= stake;
            
            // Adicionar ao dia atual
            bettingData[currentTab].entries.push(entry);
            
            // Salvar e atualizar UI
            saveData();
            renderTabContent(currentTab);
            updateUI();
            
            // Limpar formul√°rio
            document.getElementById('entryDesc').value = '';
            document.getElementById('entryOdd').value = '';
            
            console.log(`[APOSTA ADICIONADA] Stake: R$ ${stake.toFixed(2)} | Saldo: R$ ${config.availableBalance.toFixed(2)}`);
        }

        /**
         * Marca resultado de uma aposta (ganhou ou perdeu)
         */
        function markResult(index, result) {
            const entry = bettingData[currentTab].entries[index];
            
            if (entry.result !== 'pending') {
                alert('‚ö†Ô∏è Esta aposta j√° foi finalizada!');
                return;
            }
            
            entry.result = result;
            entry.settledAt = new Date().toISOString();
            
            if (result === 'win') {
                // VIT√ìRIA: devolver stake + lucro ao saldo dispon√≠vel
                config.availableBalance += entry.potentialReturn;
                config.bankroll += (entry.potentialReturn - entry.stake);
                
                // Fibonacci: voltar uma posi√ß√£o
                if (config.strategy === 'fibonacci') {
                    config.fibonacciIndex = Math.max(0, config.fibonacciIndex - 1);
                }
                
                console.log(`[VIT√ìRIA] +R$ ${(entry.potentialReturn - entry.stake).toFixed(2)} | Saldo: R$ ${config.availableBalance.toFixed(2)}`);
            } else {
                // DERROTA: apenas atualizar banca total (stake j√° foi descontado)
                config.bankroll -= entry.stake;
                
                // Fibonacci: avan√ßar uma posi√ß√£o
                if (config.strategy === 'fibonacci') {
                    config.fibonacciIndex = Math.min(config.fibonacciIndex + 1, 7);
                }
                
                console.log(`[DERROTA] -R$ ${entry.stake.toFixed(2)} | Saldo: R$ ${config.availableBalance.toFixed(2)}`);
            }
            
            saveData();
            updateUI();
            
            const message = result === 'win' ?
                `üéâ VIT√ìRIA!\n\nLucro: +R$ ${(entry.potentialReturn - entry.stake).toFixed(2)}\nSaldo dispon√≠vel: R$ ${config.availableBalance.toFixed(2)}` :
                `‚ùå DERROTA!\n\nPreju√≠zo: -R$ ${entry.stake.toFixed(2)}\nSaldo dispon√≠vel: R$ ${config.availableBalance.toFixed(2)}`;
            
            alert(message);
        }

        /**
         * Abre modal de cashout
         */
        function openCashoutModal(index) {
            currentCashoutBetIndex = index;
            const entry = bettingData[currentTab].entries[index];
            
            // Preencher valor padr√£o (stake original)
            document.getElementById('cashoutAmount').value = entry.stake.toFixed(2);
            document.getElementById('cashoutModal').classList.add('active');
        }

        /**
         * Fecha modal de cashout
         */
        function closeCashoutModal() {
            currentCashoutBetIndex = null;
            document.getElementById('cashoutModal').classList.remove('active');
        }

        /**
         * Confirma cashout
         */
        function confirmCashout() {
            if (currentCashoutBetIndex === null) return;
            
            const entry = bettingData[currentTab].entries[currentCashoutBetIndex];
            const result = document.getElementById('cashoutResult').value;
            const amount = parseFloat(document.getElementById('cashoutAmount').value);
            
            if (isNaN(amount) || amount < 0) {
                alert('‚ö†Ô∏è Valor de cashout inv√°lido!');
                return;
            }
            
            if (amount > entry.potentialReturn) {
                alert(`‚ö†Ô∏è Valor de cashout n√£o pode ser maior que o retorno potencial (R$ ${entry.potentialReturn.toFixed(2)})!`);
                return;
            }
            
            // Definir resultado
            entry.result = result === 'win' ? 'cashout-win' : 'cashout-loss';
            entry.cashoutAmount = amount;
            entry.settledAt = new Date().toISOString();
            
            // DEVOLVER VALOR DO CASHOUT AO SALDO DISPON√çVEL
            config.availableBalance += amount;
            
            // Atualizar banca total
            if (result === 'win') {
                // Ganho parcial
                const profit = amount - entry.stake;
                config.bankroll += profit;
                console.log(`[CASHOUT WIN] +R$ ${profit.toFixed(2)} | Recebido: R$ ${amount.toFixed(2)}`);
            } else {
                // Perda parcial
                const loss = entry.stake - amount;
                config.bankroll -= loss;
                console.log(`[CASHOUT LOSS] -R$ ${loss.toFixed(2)} | Recuperado: R$ ${amount.toFixed(2)}`);
            }
            
            closeCashoutModal();
            saveData();
            updateUI();
            
            const message = result === 'win' ?
                `üí∞ CASHOUT COM GANHO!\n\nValor recebido: R$ ${amount.toFixed(2)}\nLucro: +R$ ${(amount - entry.stake).toFixed(2)}` :
                `üí∞ CASHOUT COM PERDA PARCIAL!\n\nValor recuperado: R$ ${amount.toFixed(2)}\nPerda: -R$ ${(entry.stake - amount).toFixed(2)}`;
            
            alert(message);
        }

        /**
         * Deleta uma aposta
         */
        function deleteEntry(index) {
            if (!confirm('üóëÔ∏è Tem certeza que deseja deletar esta aposta?')) return;
            
            const entry = bettingData[currentTab].entries[index];
            
            // Reverter valores baseado no status
            if (entry.result === 'pending') {
                // Devolver stake ao saldo dispon√≠vel
                config.availableBalance += entry.stake;
                console.log(`[DELETE PENDING] Devolvido: R$ ${entry.stake.toFixed(2)}`);
            } else if (entry.result === 'win') {
                // Remover lucro
                config.availableBalance -= entry.potentialReturn;
                config.bankroll -= (entry.potentialReturn - entry.stake);
                console.log(`[DELETE WIN] Removido: R$ ${(entry.potentialReturn - entry.stake).toFixed(2)}`);
            } else if (entry.result === 'loss') {
                // Devolver preju√≠zo
                config.bankroll += entry.stake;
                console.log(`[DELETE LOSS] Devolvido: R$ ${entry.stake.toFixed(2)}`);
            } else if (entry.result === 'cashout-win') {
                // Remover cashout ganho
                config.availableBalance -= entry.cashoutAmount;
                config.bankroll -= (entry.cashoutAmount - entry.stake);
            } else if (entry.result === 'cashout-loss') {
                // Remover cashout perda
                config.availableBalance -= entry.cashoutAmount;
                config.bankroll += (entry.stake - entry.cashoutAmount);
            }
            
            // Remover entrada
            bettingData[currentTab].entries.splice(index, 1);
            
            saveData();
            updateUI();
        }

        // ============================================
        // FUN√á√ïES DE RENDERIZA√á√ÉO
        // ============================================

        /**
         * Renderiza sugest√µes de IA
         */
        function renderAISuggestions() {
            const suggestions = generateAISuggestions();
            const analysis = analyzePerformance();
            const dayName = getDayOfWeek(getToday());
            const dayLabel = MATCH_FREQUENCY.brasil[dayName].label;
            
            // Atualizar cards de sugest√£o
            document.getElementById('suggestedStake').textContent = `R$ ${suggestions.stake.toFixed(2)}`;
            document.getElementById('stakePercent').textContent = `${((suggestions.stake / config.bankroll) * 100).toFixed(1)}% da carteira`;
            
            document.getElementById('idealOdd').textContent = suggestions.idealOdd;
            document.getElementById('oddRange').textContent = `Min: ${suggestions.minOdd} | M√°x: ${suggestions.maxOdd}`;
            
            document.getElementById('maxBetsToday').textContent = suggestions.maxBetsToday + (suggestions.dayType === 'high' ? ' üî•' : '');
            document.getElementById('dayType').textContent = `${dayLabel} - ${suggestions.dayType === 'high' ? 'Alto volume' : 'Volume moderado'}`;
            
            const confidenceEmoji = suggestions.confidence === 'high' ? 'üü¢' :
                                   suggestions.confidence === 'medium' ? 'üü°' :
                                   suggestions.confidence === 'low' ? 'üü†' : 'üî¥';
            document.getElementById('confidenceLevel').textContent = confidenceEmoji;
            document.getElementById('strategyInfo').textContent = strategies[config.strategy].name;
            
            // Renderizar alertas
            const alerts = generateAlerts(suggestions, analysis);
            const alertsContainer = document.getElementById('aiAlerts');
            alertsContainer.innerHTML = alerts.map(alert => `
                <div class="alert alert-${alert.type}">${alert.message}</div>
            `).join('');
        }

        /**
         * Atualiza estat√≠sticas
         */
        function updateStats() {
            const analysis = analyzePerformance();
            const financials = calculateFinancials();
            
            // Carteira
            document.getElementById('totalBankroll').textContent = `R$ ${config.bankroll.toFixed(2)}`;
            const change = config.bankroll - config.initialBankroll;
            const changePercent = ((change / config.initialBankroll) * 100).toFixed(2);
            const changeClass = change >= 0 ? 'success' : 'danger';
            document.getElementById('bankrollChange').innerHTML = `<span class="${changeClass}">${change >= 0 ? '‚ñ≤' : '‚ñº'} R$ ${Math.abs(change).toFixed(2)} (${change >= 0 ? '+' : ''}${changePercent}%)</span>`;
            
            // Saldo dispon√≠vel
            document.getElementById('availableBalance').textContent = `R$ ${config.availableBalance.toFixed(2)}`;
            document.getElementById('availablePercent').textContent = `${((config.availableBalance / config.bankroll) * 100).toFixed(1)}% da carteira`;
            
            // Valor investido
            document.getElementById('investedAmount').textContent = `R$ ${financials.invested.toFixed(2)}`;
            document.getElementById('investedPercent').textContent = `${((financials.invested / config.bankroll) * 100).toFixed(1)}% investido`;
            
            // Lucro
            document.getElementById('totalProfit').textContent = `R$ ${financials.totalProfit.toFixed(2)}`;
            document.getElementById('profitCount').textContent = `${financials.profitCount} ${financials.profitCount === 1 ? 'vit√≥ria' : 'vit√≥rias'}`;
            
            // Preju√≠zo
            document.getElementById('totalLoss').textContent = `R$ ${financials.totalLoss.toFixed(2)}`;
            document.getElementById('lossCount').textContent = `${financials.lossCount} ${financials.lossCount === 1 ? 'derrota' : 'derrotas'}`;
            
            // Win rate
            if (analysis) {
                document.getElementById('actualWinRate').textContent = `${analysis.actualWinRate.toFixed(1)}%`;
                
                if (analysis.totalBets >= 20) {
                    document.getElementById('winRateHint').textContent = `‚úÖ Real (${analysis.totalBets} apostas)`;
                } else if (analysis.totalBets >= 10) {
                    document.getElementById('winRateHint').textContent = `üîÑ Transi√ß√£o (${analysis.totalBets}/20)`;
                } else {
                    document.getElementById('winRateHint').textContent = `${analysis.totalBets}/20 apostas`;
                }
            } else {
                document.getElementById('actualWinRate').textContent = '0%';
                document.getElementById('winRateHint').textContent = 'Sem hist√≥rico';
            }
            
            // Barras de distribui√ß√£o
            updateDistributionBars(financials);
        }

        /**
         * Atualiza barras de distribui√ß√£o
         */
        function updateDistributionBars(financials) {
            const availPercent = Math.max(5, (config.availableBalance / config.bankroll) * 100);
            const investPercent = Math.max(5, (financials.invested / config.bankroll) * 100);
            const profitPercent = financials.totalProfit > 0 ? Math.max(5, (financials.totalProfit / config.initialBankroll) * 100) : 5;
            const lossPercent = financials.totalLoss > 0 ? Math.max(5, (financials.totalLoss / config.initialBankroll) * 100) : 5;

            document.getElementById('barAvailable').style.width = `${Math.min(100, availPercent)}%`;
            document.getElementById('barAvailableLabel').textContent = `R$ ${config.availableBalance.toFixed(2)} (${availPercent.toFixed(0)}%)`;

            document.getElementById('barInvested').style.width = `${Math.min(100, investPercent)}%`;
            document.getElementById('barInvestedLabel').textContent = `R$ ${financials.invested.toFixed(2)} (${investPercent.toFixed(0)}%)`;

            document.getElementById('barProfit').style.width = `${Math.min(100, profitPercent)}%`;
            document.getElementById('barProfitLabel').textContent = `R$ ${financials.totalProfit.toFixed(2)}`;

            document.getElementById('barLoss').style.width = `${Math.min(100, lossPercent)}%`;
            document.getElementById('barLossLabel').textContent = `R$ ${financials.totalLoss.toFixed(2)}`;
        }

        /**
         * Renderiza abas de dias
         */
        function renderTabs() {
            const dates = Object.keys(bettingData).sort().reverse();
            const today = getToday();
            
            // Criar dia de hoje se n√£o existir
            if (!dates.includes(today)) {
                dates.unshift(today);
                bettingData[today] = { entries: [] };
            }
            
            const tabButtons = document.getElementById('tabButtons');
            tabButtons.innerHTML = dates.map((date, index) => {
                const isHighVolume = isHighVolumeDay(date);
                const activeClass = index === 0 ? 'active' : '';
                const highVolumeClass = isHighVolume ? 'high-volume' : '';
                const label = date === today ? 'üìÖ Hoje' : formatDate(date);
                
                return `
                    <div class="tab ${activeClass} ${highVolumeClass}" onclick="switchTab('${date}')">
                        ${label}
                    </div>
                `;
            }).join('');
            
            if (dates.length > 0) {
                renderTabContent(dates[0]);
            }
        }

        /**
         * Troca de aba
         */
        function switchTab(date) {
            currentTab = date;
            document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderTabContent(date);
        }

        /**
         * Renderiza conte√∫do da aba
         */
        function renderTabContent(date) {
            currentTab = date;
            if (!bettingData[date]) {
                bettingData[date] = { entries: [] };
            }
            
            const day = bettingData[date];
            const suggestions = generateAISuggestions();
            const betsToday = day.entries.length;
            const canBet = betsToday < suggestions.maxBetsToday && config.availableBalance > 0;
            
            const content = document.getElementById('tabContent');
            
            // Caixa de sugest√£o
            let suggestionBox = '';
            if (canBet) {
                suggestionBox = `
                    <div class="suggestion-box">
                        <div class="suggestion-title">‚≠ê APOSTA SUGERIDA - Baseada em dados estat√≠sticos</div>
                        <div class="suggestion-grid">
                            <div class="suggestion-item">
                                <div class="suggestion-label">Valor</div>
                                <div class="suggestion-value">R$ ${suggestions.stake.toFixed(2)}</div>
                            </div>
                            <div class="suggestion-item">
                                <div class="suggestion-label">Odd Ideal</div>
                                <div class="suggestion-value">${suggestions.idealOdd}</div>
                            </div>
                            <div class="suggestion-item">
                                <div class="suggestion-label">Faixa</div>
                                <div class="suggestion-value">${suggestions.minOdd}-${suggestions.maxOdd}</div>
                            </div>
                            <div class="suggestion-item">
                                <div class="suggestion-label">Retorno Esperado</div>
                                <div class="suggestion-value">R$ ${(suggestions.stake * parseFloat(suggestions.idealOdd)).toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Formul√°rio de nova aposta
            let formSection = '';
            if (canBet) {
                formSection = `
                    <div style="background: rgba(0, 227, 150, 0.05); border: 1px solid rgba(0, 227, 150, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #00E396;">‚ûï Nova Aposta - ${formatDate(date)}</h3>
                        <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                            Apostas hoje: ${betsToday}/${suggestions.maxBetsToday} | Saldo: R$ ${config.availableBalance.toFixed(2)}
                        </p>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Descri√ß√£o</label>
                                <input type="text" id="entryDesc" placeholder="Ex: Flamengo vs Palmeiras - Flamengo vence">
                            </div>
                            <div class="form-group">
                                <label>Odd</label>
                                <input type="number" id="entryOdd" step="0.01" placeholder="${suggestions.idealOdd}">
                            </div>
                            <div class="form-group">
                                <label>Valor (R$)</label>
                                <input type="number" id="entryStake" step="0.01" value="${suggestions.stake.toFixed(2)}" max="${config.availableBalance}">
                            </div>
                        </div>
                        <button class="btn" onclick="addEntry()">Adicionar Aposta</button>
                    </div>
                `;
            } else {
                const reason = config.availableBalance <= 0 ? 
                    'Saldo insuficiente. Aguarde os resultados das apostas pendentes.' :
                    `Limite di√°rio atingido (${suggestions.maxBetsToday} apostas). Aguarde at√© amanh√£.`;
                
                formSection = `
                    <div style="background: rgba(255, 69, 96, 0.05); border: 1px solid rgba(255, 69, 96, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 10px; color: #FF4560;">üö´ Limite Atingido</h3>
                        <p style="font-size: 14px; color: #999;">${reason}</p>
                    </div>
                `;
            }
            
            // Tabela de apostas
            let tableSection = '';
            if (day.entries.length === 0) {
                tableSection = `
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;">üìù</div>
                        <p>Nenhuma aposta registrada neste dia.</p>
                    </div>
                `;
            } else {
                tableSection = `
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Odd</th>
                                <th>Valor</th>
                                <th>Retorno</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${day.entries.map((entry, index) => {
                                let statusClass = 'pending';
                                let statusText = '‚è≥ Pendente';
                                
                                if (entry.result === 'win') {
                                    statusClass = 'win';
                                    statusText = '‚úÖ Ganhou';
                                } else if (entry.result === 'loss') {
                                    statusClass = 'loss';
                                    statusText = '‚ùå Perdeu';
                                } else if (entry.result === 'cashout-win') {
                                    statusClass = 'cashout';
                                    statusText = `üí∞ Cashout ‚úÖ (R$ ${entry.cashoutAmount.toFixed(2)})`;
                                } else if (entry.result === 'cashout-loss') {
                                    statusClass = 'cashout';
                                    statusText = `üí∞ Cashout ‚ùå (R$ ${entry.cashoutAmount.toFixed(2)})`;
                                }
                                
                                return `
                                    <tr>
                                        <td><strong>${entry.description}</strong></td>
                                        <td>${entry.odd.toFixed(2)}</td>
                                        <td>R$ ${entry.stake.toFixed(2)}</td>
                                        <td>R$ ${entry.potentialReturn.toFixed(2)}</td>
                                        <td><span class="badge badge-${statusClass}">${statusText}</span></td>
                                        <td>
                                            <div style="display: flex; gap: 8px;">
                                                ${entry.result === 'pending' ? `
                                                    <button class="btn btn-success" onclick="markResult(${index}, 'win')">‚úÖ</button>
                                                    <button class="btn btn-danger" onclick="markResult(${index}, 'loss')">‚ùå</button>
                                                    <button class="btn btn-warning" onclick="openCashoutModal(${index})">üí∞</button>
                                                ` : ''}
                                                <button class="btn btn-secondary" onclick="deleteEntry(${index})">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            content.innerHTML = suggestionBox + formSection + tableSection;
        }

        /**
         * Atualiza toda a UI
         */
        function updateUI() {
            renderAISuggestions();
            updateStats();
            renderTabs();
            updateDebugInfo();
        }

        /**
         * Atualiza informa√ß√µes de debug
         */
        function updateDebugInfo() {
            const debugInfo = {
                bankroll: config.bankroll.toFixed(2),
                available: config.availableBalance.toFixed(2),
                strategy: config.strategy,
                winRate: config.estimatedWinRate,
                fibonacci: config.fibonacciIndex,
                totalDays: Object.keys(bettingData).length,
                totalEntries: Object.values(bettingData).reduce((sum, day) => sum + day.entries.length, 0)
            };
            
            document.getElementById('debugInfo').textContent = JSON.stringify(debugInfo, null, 2);
        }

        // ============================================
        // FUN√á√ïES DE CONFIGURA√á√ÉO E MODALS
        // ============================================

        function openConfigModal() {
            document.getElementById('bankrollInput').value = config.bankroll.toFixed(2);
            document.getElementById('winRateInput').value = config.estimatedWinRate;
            document.getElementById('strategySelect').value = config.strategy;
            
            const analysis = analyzePerformance();
            const hint = document.getElementById('winRateHintConfig');
            if (analysis && analysis.totalBets >= 20) {
                hint.textContent = `Sistema usando ${analysis.actualWinRate.toFixed(1)}% (real) automaticamente`;
            } else if (analysis && analysis.totalBets >= 10) {
                hint.textContent = `${analysis.totalBets}/20 apostas para win rate real`;
            } else {
                hint.textContent = 'Estime conservadoramente (50-55%)';
            }
            
            document.getElementById('configModal').classList.add('active');
        }

        function closeConfigModal() {
            document.getElementById('configModal').classList.remove('active');
        }

        function updateConfig() {
            const newBankroll = parseFloat(document.getElementById('bankrollInput').value);
            const newWinRate = parseInt(document.getElementById('winRateInput').value);
            const newStrategy = document.getElementById('strategySelect').value;
            
            if (isNaN(newBankroll) || newBankroll <= 0) {
                alert('‚ö†Ô∏è Carteira deve ser maior que zero!');
                return;
            }
            
            if (isNaN(newWinRate) || newWinRate < 30 || newWinRate > 80) {
                alert('‚ö†Ô∏è Win rate deve estar entre 30% e 80%!');
                return;
            }
            
            // Ajustar saldo dispon√≠vel proporcionalmente
            const oldBankroll = config.bankroll;
            const diff = newBankroll - oldBankroll;
            config.availableBalance += diff;
            
            config.bankroll = newBankroll;
            config.estimatedWinRate = newWinRate;
            config.strategy = newStrategy;
            
            if (!config.initialBankroll) {
                config.initialBankroll = newBankroll;
            }
            
            closeConfigModal();
            saveData();
            updateUI();
            alert('‚úÖ Configura√ß√µes salvas com sucesso!');
        }

        function openImportModal() {
            document.getElementById('importModal').classList.add('active');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        function importData() {
            try {
                const jsonStr = document.getElementById('importData').value;
                const data = JSON.parse(jsonStr);
                
                if (!data.config || !data.bettingData) {
                    alert('‚ùå Formato de backup inv√°lido!');
                    return;
                }
                
                if (confirm('‚ö†Ô∏è Isso vai SUBSTITUIR todos os dados atuais. Confirma?')) {
                    config = data.config;
                    bettingData = data.bettingData;
                    
                    saveData();
                    updateUI();
                    closeImportModal();
                    
                    alert('‚úÖ Dados importados com sucesso!');
                }
            } catch (e) {
                alert('‚ùå Erro ao importar! Verifique se o JSON est√° correto.');
                console.error(e);
            }
        }

        // ============================================
        // FUN√á√ïES DE PERSIST√äNCIA
        // ============================================

        function testLocalStorage() {
            try {
                const test = '__test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch(e) {
                return false;
            }
        }

        const hasLocalStorage = testLocalStorage();

        function saveData() {
            try {
                config.lastSave = new Date().toISOString();
                
                if (hasLocalStorage) {
                    localStorage.setItem('bettingConfig', JSON.stringify(config));
                    localStorage.setItem('bettingData', JSON.stringify(bettingData));
                }
                
                console.log('[SAVE] Dados salvos:', new Date().toLocaleTimeString());
                return true;
            } catch (e) {
                console.error('[SAVE ERROR]', e);
                return false;
            }
        }

        function loadData() {
            try {
                if (hasLocalStorage) {
                    const savedConfig = localStorage.getItem('bettingConfig');
                    const savedData = localStorage.getItem('bettingData');
                    
                    if (savedConfig) {
                        config = JSON.parse(savedConfig);
                        console.log('[LOAD] Config carregada');
                    }
                    
                    if (savedData) {
                        bettingData = JSON.parse(savedData);
                        console.log('[LOAD] Dados carregados');
                    }
                }
                
                updateUI();
                return true;
            } catch (e) {
                console.error('[LOAD ERROR]', e);
                return false;
            }
        }

        function manualSave() {
            if (saveData()) {
                alert('‚úÖ Dados salvos com sucesso!');
            } else {
                alert('‚ùå Erro ao salvar!');
            }
        }

        function exportData() {
            const data = {
                config: config,
                bettingData: bettingData,
                exportDate: new Date().toISOString(),
                version: '4.0-criteryon-backend'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `criteryon-backup-${getToday()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Backup exportado!');
        }

        // ============================================
        // UTILIT√ÅRIOS
        // ============================================

        function getToday() {
            return new Date().toISOString().split('T')[0];
        }

        function formatDate(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================

        // Auto-save a cada 30 segundos
        setInterval(() => {
            saveData();
        }, 30000);

        // Inicializar ao carregar
        window.onload = function() {
            console.log('[INIT] Criteryon Backend v4.0');
            loadData();
            
            // Salvar antes de sair
            window.addEventListener('beforeunload', () => {
                saveData();
            });
            
            console.log('[INIT] Sistema iniciado com sucesso!');
        };
    </script>
</body>
</html>
