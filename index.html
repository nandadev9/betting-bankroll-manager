<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criteryon v6 - Gest√£o Multi-Carteiras</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0A0A0A;
            color: #FFFFFF;
            line-height: 1.6;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        
        /* HEADER */
        .main-header {
            background: linear-gradient(135deg, #1A1A1A, #2A2A2A);
            border-bottom: 2px solid #F5B342;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        h1 { 
            color: #F5B342; 
            font-size: 32px;
            text-shadow: 0 2px 10px rgba(245, 179, 66, 0.3);
        }
        .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        
        /* WALLET TABS */
        .wallet-tabs {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            border-bottom: 1px solid #333;
        }
        .wallet-tab {
            padding: 12px 24px;
            background: #1A1A1A;
            border: 2px solid #333;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }
        .wallet-tab:hover { 
            background: #222; 
            border-color: #F5B342;
        }
        .wallet-tab.active { 
            background: #F5B342; 
            color: #0A0A0A; 
            border-color: #F5B342;
        }
        .wallet-tab.dashboard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        .wallet-tab.dashboard.active {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        .wallet-tab-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #00E396;
            color: #000;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 10px;
            font-weight: 700;
        }
        
        /* BUTTONS */
        .btn {
            padding: 10px 20px;
            background: #F5B342;
            color: #0A0A0A;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .btn:hover { background: #FFD166; transform: translateY(-2px); }
        .btn-secondary { background: #333; color: #FFF; }
        .btn-secondary:hover { background: #444; }
        .btn-success { background: #00E396; padding: 8px 16px; font-size: 13px; }
        .btn-danger { background: #FF4560; padding: 8px 16px; font-size: 13px; color: #FFF; }
        .btn-warning { background: #FEB019; padding: 8px 16px; font-size: 13px; color: #000; }
        .btn-info { background: #3b82f6; padding: 8px 16px; font-size: 13px; color: #FFF; }
        .btn-purple { background: #9333ea; padding: 8px 16px; font-size: 13px; color: #FFF; }
        
        /* GRID */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        
        /* CARDS */
        .card {
            background: linear-gradient(135deg, #1A1A1A, #252525);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: #F5B342;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(245, 179, 66, 0.1);
        }
        .card-title {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 1.5px;
            font-weight: 600;
        }
        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: #F5B342;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(245, 179, 66, 0.2);
        }
        .card-subtitle { font-size: 13px; color: #666; }
        
        /* COLORS */
        .success { color: #00E396; }
        .danger { color: #FF4560; }
        .warning { color: #FEB019; }
        .info { color: #3b82f6; }
        .purple { color: #9333ea; }
        
        /* SECTIONS */
        .section { margin-bottom: 30px; }
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #F5B342;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ALERTS */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .alert-success { background: rgba(0, 227, 150, 0.1); border-color: #00E396; color: #00E396; }
        .alert-warning { background: rgba(254, 176, 25, 0.1); border-color: #FEB019; color: #FEB019; }
        .alert-danger { background: rgba(255, 69, 96, 0.1); border-color: #FF4560; color: #FF4560; }
        .alert-info { background: rgba(59, 130, 246, 0.1); border-color: #3b82f6; color: #3b82f6; }
        
        /* FORMS */
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block;
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            background: #0A0A0A;
            border: 1px solid #333;
            border-radius: 8px;
            color: #FFF;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #F5B342;
            box-shadow: 0 0 0 3px rgba(245, 179, 66, 0.1);
        }
        .form-row { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        /* TABLE */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th {
            background: #1A1A1A;
            padding: 12px;
            text-align: left;
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            border-bottom: 2px solid #333;
            font-weight: 600;
        }
        td {
            padding: 15px 12px;
            border-bottom: 1px solid #222;
        }
        tr:hover { background: #1A1A1A; }
        
        /* BADGES */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
        }
        .badge-pending { background: rgba(254, 176, 25, 0.2); color: #FEB019; }
        .badge-win { background: rgba(0, 227, 150, 0.2); color: #00E396; }
        .badge-loss { background: rgba(255, 69, 96, 0.2); color: #FF4560; }
        .badge-cashout { background: rgba(245, 179, 66, 0.2); color: #F5B342; }
        .badge-bonus { background: rgba(147, 51, 234, 0.2); color: #9333ea; }
        
        /* TABS */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .tab {
            padding: 10px 20px;
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .tab:hover { background: #222; }
        .tab.active { background: #F5B342; color: #0A0A0A; border-color: #F5B342; }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal.active { display: flex; }
        .modal-content {
            background: linear-gradient(135deg, #1A1A1A, #252525);
            border: 2px solid #F5B342;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-title { 
            font-size: 24px; 
            margin-bottom: 20px; 
            color: #F5B342;
            font-weight: 700;
        }
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        /* BARS */
        .bar {
            height: 10px;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .bar-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        .bar-available { background: linear-gradient(90deg, #00E396, #00C48C); }
        .bar-invested { background: linear-gradient(90deg, #FEB019, #D4941F); }
        .bar-profit { background: linear-gradient(90deg, #00E396, #00C48C); }
        .bar-loss { background: linear-gradient(90deg, #FF4560, #DC143C); }
        .bar-bonus { background: linear-gradient(90deg, #9333ea, #7c3aed); }
        
        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        /* TRANSACTION CARD */
        .transaction-item {
            background: #1A1A1A;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        .transaction-item:hover {
            border-color: #F5B342;
            transform: translateX(5px);
        }
        .transaction-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .transaction-type {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
        }
        .transaction-amount {
            font-size: 20px;
            font-weight: 700;
        }
        .transaction-date {
            font-size: 11px;
            color: #666;
        }
        
        /* DASHBOARD CONSOLIDATED */
        .consolidated-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 25px;
        }
        .consolidated-card .card-value {
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .consolidated-card .card-title,
        .consolidated-card .card-subtitle {
            color: rgba(255,255,255,0.9);
        }
        
        /* TOGGLE SWITCH */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: .4s;
            border-radius: 24px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #10b981;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* WALLET SELECTOR */
        .wallet-quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1A1A1A;
        }
        ::-webkit-scrollbar-thumb {
            background: #F5B342;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #FFD166;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .header-top {
                flex-direction: column;
                align-items: flex-start;
            }
            .wallet-tabs {
                flex-wrap: nowrap;
                overflow-x: scroll;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="main-header">
            <div class="header-top">
                <div>
                    <h1>üí∞ CRITERYON v6.0</h1>
                    <p style="color: #999; font-size: 14px;">Sistema Multi-Carteiras de Gest√£o de Apostas</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-purple" onclick="openWalletModal()">‚ûï Nova Bet</button>
                    <button class="btn btn-success" onclick="openDepositModal()">üíµ Dep√≥sito</button>
                    <button class="btn btn-danger" onclick="openWithdrawModal()">üí∏ Saque</button>
                    <button class="btn btn-secondary" onclick="openConfigModal()">‚öôÔ∏è Config</button>
                    <button class="btn btn-info" onclick="openImportModal()">üì§ Importar</button>
                    <button class="btn btn-secondary" onclick="exportData()">üì• Exportar</button>
                </div>
            </div>
            
            <!-- Wallet Tabs -->
            <div class="wallet-tabs" id="walletTabs"></div>
        </div>

        <!-- Content Area -->
        <div id="contentArea"></div>
    </div>

    <!-- Modals -->
    
    <!-- New Wallet Modal -->
    <div class="modal" id="walletModal">
        <div class="modal-content">
            <div class="modal-title">‚ûï Nova Carteira (Bet)</div>
            <div class="form-group">
                <label>Nome da Bet</label>
                <select id="newWalletName">
                    <option value="custom">üéØ Personalizado</option>
                    <option value="Betano">üé∞ Betano</option>
                    <option value="Bet365">üé≤ Bet365</option>
                    <option value="Estrela Bet">‚≠ê Estrela Bet</option>
                    <option value="Superbet">ü¶∏ Superbet</option>
                    <option value="7k">7Ô∏è‚É£ 7k</option>
                    <option value="PixBet">üíö PixBet</option>
                    <option value="Sportingbet">üèÜ Sportingbet</option>
                    <option value="KTO">üéØ KTO</option>
                    <option value="Betfair">üìä Betfair</option>
                </select>
            </div>
            <div class="form-group" id="customNameGroup" style="display: none;">
                <label>Nome Personalizado</label>
                <input type="text" id="customWalletName" placeholder="Ex: Minha Bet">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Saldo Inicial (R$)</label>
                    <input type="number" id="newWalletBalance" step="0.01" min="1" value="100">
                </div>
                <div class="form-group">
                    <label>Win Rate Estimado (%)</label>
                    <input type="number" id="newWalletWinRate" step="1" min="30" max="80" value="55">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeWalletModal()">Cancelar</button>
                <button class="btn" onclick="createWallet()">Criar Carteira</button>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-title">üíµ Dep√≥sito</div>
            <div class="form-group">
                <label>Valor (R$)</label>
                <input type="number" id="depositAmount" step="0.01" min="1">
            </div>
            <div class="form-group">
                <label>Observa√ß√£o (opcional)</label>
                <input type="text" id="depositNote" placeholder="Ex: Dep√≥sito inicial, Recarga mensal...">
            </div>
            <div class="alert alert-info">
                ‚ÑπÔ∏è Dep√≥sitos aumentam seu saldo mas n√£o afetam m√©tricas de ROI e performance.
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeDepositModal()">Cancelar</button>
                <button class="btn btn-success" onclick="confirmDeposit()">Confirmar Dep√≥sito</button>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <div class="modal-title">üí∏ Saque</div>
            <div class="form-group">
                <label>Valor (R$)</label>
                <input type="number" id="withdrawAmount" step="0.01" min="1">
            </div>
            <div class="form-group">
                <label>Observa√ß√£o (opcional)</label>
                <input type="text" id="withdrawNote" placeholder="Ex: Saque de lucros, Emerg√™ncia...">
            </div>
            <div class="alert alert-warning">
                ‚ö†Ô∏è Saques reduzem seu saldo mas n√£o afetam m√©tricas de ROI e performance.
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeWithdrawModal()">Cancelar</button>
                <button class="btn btn-danger" onclick="confirmWithdraw()">Confirmar Saque</button>
            </div>
        </div>
    </div>

    <!-- Config Modal -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-title">‚öôÔ∏è Configura√ß√µes da Carteira</div>
            <div class="form-group">
                <label>Nome da Carteira</label>
                <input type="text" id="configWalletName">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Win Rate Estimado (%)</label>
                    <input type="number" id="configWinRate" step="1" min="30" max="80">
                </div>
            </div>
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <span>Estrat√©gia Autom√°tica</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="configAutoStrategy" checked onchange="toggleAutoStrategy()">
                        <span class="toggle-slider"></span>
                    </label>
                </label>
                <div class="alert alert-info" style="font-size: 12px; margin-bottom: 15px;">
                    ‚ÑπÔ∏è <strong>Modo Autom√°tico:</strong> O sistema analisa sua performance e escolhe a melhor estrat√©gia para cada momento.
                </div>
            </div>
            <div class="form-group" id="manualStrategyGroup" style="display: none;">
                <label>Estrat√©gia Manual</label>
                <select id="configStrategy">
                    <option value="kelly">Kelly Criterion (Agressivo)</option>
                    <option value="kelly_fractional">Kelly Fracion√°rio (Equilibrado)</option>
                    <option value="fibonacci">Fibonacci Recovery (Recupera√ß√£o)</option>
                    <option value="percentage">Percentage Staking (Conservador)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="deleteWallet()">üóëÔ∏è Excluir Carteira</button>
                <button class="btn btn-secondary" onclick="closeConfigModal()">Cancelar</button>
                <button class="btn" onclick="updateConfig()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Cashout Modal -->
    <div class="modal" id="cashoutModal">
        <div class="modal-content">
            <div class="modal-title">üí∞ Cashout</div>
            <div class="form-group">
                <label>Resultado</label>
                <select id="cashoutResult">
                    <option value="win">‚úÖ Ganhou</option>
                    <option value="loss">‚ùå Perdeu</option>
                </select>
            </div>
            <div class="form-group">
                <label>Valor Recebido (R$)</label>
                <input type="number" id="cashoutAmount" step="0.01" min="0">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeCashoutModal()">Cancelar</button>
                <button class="btn" onclick="confirmCashout()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-title">üì§ Importar Backup</div>
            <div class="form-group">
                <label>Cole o JSON do backup:</label>
                <textarea id="importData" rows="10" style="font-family: monospace;" placeholder='{"version": "6.0", "wallets": {...}}'></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeImportModal()">Cancelar</button>
                <button class="btn" onclick="importData()">Importar</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ESTRUTURA DE DADOS GLOBAL
        // ============================================

        let appState = {
            version: '6.0',
            currentWalletId: null,
            currentView: 'dashboard', // 'dashboard' ou 'wallet'
            wallets: {}
        };

        const MATCH_FREQUENCY = {
            brasil: {
                segunda: { min: 3, max: 5, label: 'Segunda' },
                terca: { min: 2, max: 3, label: 'Ter√ßa' },
                quarta: { min: 15, max: 20, label: 'Quarta' },
                quinta: { min: 15, max: 20, label: 'Quinta' },
                sexta: { min: 2, max: 5, label: 'Sexta' },
                sabado: { min: 30, max: 35, label: 'S√°bado' },
                domingo: { min: 25, max: 30, label: 'Domingo' }
            }
        };

        const strategies = {
            kelly: {
                name: 'Kelly Criterion',
                description: 'Agressivo - Maximiza crescimento no longo prazo',
                emoji: 'üöÄ',
                risk: 'high',
                calculate: (bankroll, odd, winRate) => {
                    const p = winRate / 100;
                    const q = 1 - p;
                    const b = odd - 1;
                    const kelly = (p * b - q) / b;
                    return Math.max(0, Math.min(0.25, kelly)) * bankroll;
                }
            },
            kelly_fractional: {
                name: 'Kelly Fracion√°rio',
                description: 'Equilibrado - 25% do Kelly, menor volatilidade',
                emoji: '‚öñÔ∏è',
                risk: 'medium',
                calculate: (bankroll, odd, winRate) => {
                    const fullKelly = strategies.kelly.calculate(bankroll, odd, winRate);
                    return fullKelly * 0.25;
                }
            },
            fibonacci: {
                name: 'Fibonacci Recovery',
                description: 'Recupera√ß√£o - Progress√£o ap√≥s perdas',
                emoji: 'üîÑ',
                risk: 'medium',
                calculate: (bankroll, odd, winRate, fibIndex) => {
                    const sequence = [1, 1, 2, 3, 5, 8, 13, 21];
                    const baseUnit = bankroll * 0.02;
                    return baseUnit * (sequence[fibIndex] || 1);
                }
            },
            percentage: {
                name: 'Percentage Staking',
                description: 'Conservador - Percentual fixo da banca',
                emoji: 'üõ°Ô∏è',
                risk: 'low',
                calculate: (bankroll, odd, winRate) => {
                    const percent = winRate >= 60 ? 0.05 : winRate >= 55 ? 0.04 : 0.03;
                    return bankroll * percent;
                }
            }
        };

        let currentCashoutBetIndex = null;
        let currentTab = null;

        // ============================================
        // WALLET MANAGEMENT
        // ============================================

        function createDefaultWallet() {
            const id = 'wallet_' + Date.now();
            appState.wallets[id] = {
                id: id,
                name: 'Bet365',
                config: {
                    bankroll: 100,
                    initialBankroll: 100,
                    availableBalance: 100,
                    bonusBalance: 0,
                    strategy: 'kelly_fractional',
                    estimatedWinRate: 55,
                    fibonacciIndex: 0,
                    autoStrategy: true
                },
                bettingData: {},
                transactions: [],
                createdAt: new Date().toISOString()
            };
            appState.currentWalletId = id;
        }

        function openWalletModal() {
            document.getElementById('newWalletName').value = 'custom';
            document.getElementById('customNameGroup').style.display = 'none';
            document.getElementById('newWalletBalance').value = '100';
            document.getElementById('newWalletWinRate').value = '55';
            document.getElementById('walletModal').classList.add('active');
        }

        function closeWalletModal() {
            document.getElementById('walletModal').classList.remove('active');
        }

        document.getElementById('newWalletName').addEventListener('change', function() {
            const customGroup = document.getElementById('customNameGroup');
            customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
        });

        function createWallet() {
            const nameSelect = document.getElementById('newWalletName').value;
            const customName = document.getElementById('customWalletName').value.trim();
            const balance = parseFloat(document.getElementById('newWalletBalance').value);
            const winRate = parseInt(document.getElementById('newWalletWinRate').value);

            const name = nameSelect === 'custom' ? customName : nameSelect;

            if (!name) {
                alert('‚ö†Ô∏è Digite um nome para a carteira!');
                return;
            }

            if (isNaN(balance) || balance <= 0) {
                alert('‚ö†Ô∏è Saldo inicial deve ser maior que zero!');
                return;
            }

            const id = 'wallet_' + Date.now();
            appState.wallets[id] = {
                id: id,
                name: name,
                config: {
                    bankroll: balance,
                    initialBankroll: balance,
                    availableBalance: balance,
                    bonusBalance: 0,
                    strategy: 'kelly_fractional',
                    estimatedWinRate: winRate,
                    fibonacciIndex: 0,
                    autoStrategy: true
                },
                bettingData: {},
                transactions: [{
                    type: 'deposit',
                    amount: balance,
                    note: 'Dep√≥sito inicial',
                    timestamp: new Date().toISOString()
                }],
                createdAt: new Date().toISOString()
            };

            appState.currentWalletId = id;
            closeWalletModal();
            saveData();
            renderApp();
            alert(`‚úÖ Carteira "${name}" criada com sucesso!`);
        }

        function deleteWallet() {
            if (!confirm('‚ö†Ô∏è TEM CERTEZA que deseja DELETAR esta carteira?\n\nTodos os dados ser√£o perdidos permanentemente!')) {
                return;
            }

            const walletId = appState.currentWalletId;
            delete appState.wallets[walletId];

            const remainingWallets = Object.keys(appState.wallets);
            if (remainingWallets.length > 0) {
                appState.currentWalletId = remainingWallets[0];
                appState.currentView = 'wallet';
            } else {
                createDefaultWallet();
                appState.currentView = 'dashboard';
            }

            closeConfigModal();
            saveData();
            renderApp();
            alert('‚úÖ Carteira deletada!');
        }

        function getCurrentWallet() {
            return appState.wallets[appState.currentWalletId];
        }

        // ============================================
        // TRANSACTIONS (DEPOSIT/WITHDRAW)
        // ============================================

        function openDepositModal() {
            if (appState.currentView === 'dashboard') {
                alert('‚ö†Ô∏è Selecione uma carteira espec√≠fica para fazer dep√≥sito.');
                return;
            }
            document.getElementById('depositAmount').value = '';
            document.getElementById('depositNote').value = '';
            document.getElementById('depositModal').classList.add('active');
        }

        function closeDepositModal() {
            document.getElementById('depositModal').classList.remove('active');
        }

        function confirmDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const note = document.getElementById('depositNote').value.trim();

            if (isNaN(amount) || amount <= 0) {
                alert('‚ö†Ô∏è Digite um valor v√°lido!');
                return;
            }

            const wallet = getCurrentWallet();
            wallet.config.bankroll += amount;
            wallet.config.availableBalance += amount;

            wallet.transactions.push({
                type: 'deposit',
                amount: amount,
                note: note || 'Dep√≥sito',
                timestamp: new Date().toISOString()
            });

            closeDepositModal();
            saveData();
            renderApp();
            alert(`‚úÖ Dep√≥sito de R$ ${amount.toFixed(2)} realizado com sucesso!`);
        }

        function openWithdrawModal() {
            if (appState.currentView === 'dashboard') {
                alert('‚ö†Ô∏è Selecione uma carteira espec√≠fica para fazer saque.');
                return;
            }
            document.getElementById('withdrawAmount').value = '';
            document.getElementById('withdrawNote').value = '';
            document.getElementById('withdrawModal').classList.add('active');
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.remove('active');
        }

        function confirmWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const note = document.getElementById('withdrawNote').value.trim();
            const wallet = getCurrentWallet();

            if (isNaN(amount) || amount <= 0) {
                alert('‚ö†Ô∏è Digite um valor v√°lido!');
                return;
            }

            if (amount > wallet.config.availableBalance) {
                alert(`‚ö†Ô∏è Saldo insuficiente! Dispon√≠vel: R$ ${wallet.config.availableBalance.toFixed(2)}`);
                return;
            }

            wallet.config.bankroll -= amount;
            wallet.config.availableBalance -= amount;

            wallet.transactions.push({
                type: 'withdraw',
                amount: amount,
                note: note || 'Saque',
                timestamp: new Date().toISOString()
            });

            closeWithdrawModal();
            saveData();
            renderApp();
            alert(`‚úÖ Saque de R$ ${amount.toFixed(2)} realizado com sucesso!`);
        }

        // ============================================
        // BETTING FUNCTIONS (mantendo l√≥gica original)
        // ============================================

        function getDayOfWeek(dateStr) {
            const days = ['domingo', 'segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado'];
            const date = new Date(dateStr + 'T12:00:00');
            return days[date.getDay()];
        }

        function getMaxBetsForDay(dateStr) {
            const dayName = getDayOfWeek(dateStr);
            const freq = MATCH_FREQUENCY.brasil[dayName];
            if (freq.min >= 15) return 5;
            if (freq.min >= 10) return 3;
            return 2;
        }

        function isHighVolumeDay(dateStr) {
            const dayName = getDayOfWeek(dateStr);
            return MATCH_FREQUENCY.brasil[dayName].min >= 15;
        }

        function calculateFinancials(wallet) {
            let invested = 0;
            let totalProfit = 0;
            let totalLoss = 0;
            let profitCount = 0;
            let lossCount = 0;

            Object.values(wallet.bettingData).forEach(day => {
                day.entries.forEach(entry => {
                    if (entry.result === 'pending') {
                        invested += entry.stake;
                    } else if (entry.result === 'win') {
                        const profit = entry.potentialReturn - entry.stake;
                        totalProfit += profit;
                        profitCount++;
                    } else if (entry.result === 'loss') {
                        totalLoss += entry.stake;
                        lossCount++;
                    } else if (entry.result === 'cashout-win') {
                        const profit = entry.cashoutAmount - entry.stake;
                        totalProfit += profit;
                        profitCount++;
                    } else if (entry.result === 'cashout-loss') {
                        const loss = entry.stake - entry.cashoutAmount;
                        totalLoss += loss;
                        lossCount++;
                    }
                });
            });

            return {
                invested,
                totalProfit,
                totalLoss,
                profitCount,
                lossCount,
                netProfit: totalProfit - totalLoss
            };
        }

        function analyzePerformance(wallet) {
            let allEntries = [];
            
            Object.values(wallet.bettingData).forEach(day => {
                allEntries = allEntries.concat(day.entries.filter(e => e.result !== 'pending'));
            });

            if (allEntries.length === 0) return null;

            const wins = allEntries.filter(e => 
                e.result === 'win' || e.result === 'cashout-win'
            ).length;
            const losses = allEntries.filter(e => 
                e.result === 'loss' || e.result === 'cashout-loss'
            ).length;
            
            const actualWinRate = (wins / allEntries.length) * 100;

            let currentStreak = 0;
            let streakType = null;
            for (let i = allEntries.length - 1; i >= 0; i--) {
                const result = allEntries[i].result;
                const isWin = result === 'win' || result === 'cashout-win';
                const isLoss = result === 'loss' || result === 'cashout-loss';
                
                if (!streakType) {
                    streakType = isWin ? 'win' : 'loss';
                    currentStreak = 1;
                } else if ((streakType === 'win' && isWin) || (streakType === 'loss' && isLoss)) {
                    currentStreak++;
                } else {
                    break;
                }
            }

            const last10 = allEntries.slice(-10);
            const last10Wins = last10.filter(e => 
                e.result === 'win' || e.result === 'cashout-win'
            ).length;
            const last10WinRate = last10.length > 0 ? (last10Wins / last10.length) * 100 : 0;

            return {
                totalBets: allEntries.length,
                wins,
                losses,
                actualWinRate,
                currentStreak,
                streakType,
                last10WinRate
            };
        }

        // ... (continua no pr√≥ximo arquivo - est√° ficando muito grande)
        
        // Por ora vou finalizar com as fun√ß√µes essenciais de render

        function renderApp() {
            renderWalletTabs();
            if (appState.currentView === 'dashboard') {
                renderDashboard();
            } else {
                renderWalletView();
            }
        }

        function renderWalletTabs() {
            const container = document.getElementById('walletTabs');
            const wallets = Object.values(appState.wallets);

            let html = `
                <div class="wallet-tab dashboard ${appState.currentView === 'dashboard' ? 'active' : ''}" 
                     onclick="switchView('dashboard')">
                    üìä Dashboard Geral
                </div>
            `;

            wallets.forEach(wallet => {
                const isActive = appState.currentView === 'wallet' && appState.currentWalletId === wallet.id;
                const financials = calculateFinancials(wallet);
                const hasProfit = financials.netProfit > 0;
                
                html += `
                    <div class="wallet-tab ${isActive ? 'active' : ''}" 
                         onclick="switchView('wallet', '${wallet.id}')">
                        ${wallet.name}
                        ${hasProfit ? '<span class="wallet-tab-badge">+' + financials.netProfit.toFixed(0) + '</span>' : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function switchView(view, walletId = null) {
            appState.currentView = view;
            if (walletId) {
                appState.currentWalletId = walletId;
            }
            renderApp();
        }

        function renderDashboard() {
            const contentArea = document.getElementById('contentArea');
            const wallets = Object.values(appState.wallets);
            
            // Calcular totais consolidados
            let totalBankroll = 0;
            let totalProfit = 0;
            let totalLoss = 0;
            let totalBets = 0;
            let totalWins = 0;

            wallets.forEach(wallet => {
                const financials = calculateFinancials(wallet);
                const analysis = analyzePerformance(wallet);
                
                totalBankroll += wallet.config.bankroll;
                totalProfit += financials.totalProfit;
                totalLoss += financials.totalLoss;
                
                if (analysis) {
                    totalBets += analysis.totalBets;
                    totalWins += analysis.wins;
                }
            });

            const consolidatedWinRate = totalBets > 0 ? (totalWins / totalBets) * 100 : 0;
            const netProfit = totalProfit - totalLoss;

            contentArea.innerHTML = `
                <div class="section">
                    <div class="section-title">üìä Vis√£o Consolidada de Todas as Carteiras</div>
                    <div class="grid">
                        <div class="card consolidated-card">
                            <div class="card-title">üí∞ SALDO TOTAL</div>
                            <div class="card-value">R$ ${totalBankroll.toFixed(2)}</div>
                            <div class="card-subtitle">${wallets.length} carteira(s) ativa(s)</div>
                        </div>
                        <div class="card consolidated-card">
                            <div class="card-title">üìà LUCRO CONSOLIDADO</div>
                            <div class="card-value">R$ ${netProfit.toFixed(2)}</div>
                            <div class="card-subtitle">${netProfit >= 0 ? '‚úÖ' : '‚ùå'} ${Math.abs((netProfit/totalBankroll)*100).toFixed(1)}% do total</div>
                        </div>
                        <div class="card consolidated-card">
                            <div class="card-title">üéØ WIN RATE GERAL</div>
                            <div class="card-value">${consolidatedWinRate.toFixed(1)}%</div>
                            <div class="card-subtitle">${totalWins}/${totalBets} apostas ganhas</div>
                        </div>
                        <div class="card consolidated-card">
                            <div class="card-title">üìä TOTAL DE APOSTAS</div>
                            <div class="card-value">${totalBets}</div>
                            <div class="card-subtitle">Em todas as carteiras</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">üíº Suas Carteiras</div>
                    <div class="grid">
                        ${wallets.map(wallet => {
                            const financials = calculateFinancials(wallet);
                            const analysis = analyzePerformance(wallet);
                            const roi = ((wallet.config.bankroll - wallet.config.initialBankroll) / wallet.config.initialBankroll) * 100;
                            
                            return `
                                <div class="card" style="cursor: pointer;" onclick="switchView('wallet', '${wallet.id}')">
                                    <div class="card-title">${wallet.name}</div>
                                    <div class="card-value">R$ ${wallet.config.bankroll.toFixed(2)}</div>
                                    <div class="card-subtitle ${roi >= 0 ? 'success' : 'danger'}">
                                        ${roi >= 0 ? '‚ñ≤' : '‚ñº'} ${roi.toFixed(1)}% ROI
                                    </div>
                                    <div style="margin-top: 10px; font-size: 12px; color: #999;">
                                        ${analysis ? analysis.totalBets + ' apostas' : 'Sem apostas'} ‚Ä¢ 
                                        ${analysis ? analysis.actualWinRate.toFixed(0) + '% win rate' : '0% win rate'}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderWalletView() {
            const wallet = getCurrentWallet();
            if (!wallet) {
                renderDashboard();
                return;
            }

            // Renderizar view completa da carteira (similar ao c√≥digo original)
            const contentArea = document.getElementById('contentArea');
            const financials = calculateFinancials(wallet);
            const analysis = analyzePerformance(wallet);
            
            contentArea.innerHTML = `
                <div class="alert alert-info">
                    üéØ Carteira: <strong>${wallet.name}</strong> ‚Ä¢ 
                    Use os bot√µes no topo para Dep√≥sito/Saque que n√£o afetam ROI
                </div>

                <!-- Stats Grid -->
                <div class="grid">
                    <div class="card">
                        <div class="card-title">üí∞ Carteira Total</div>
                        <div class="card-value">R$ ${wallet.config.bankroll.toFixed(2)}</div>
                        <div class="card-subtitle">
                            ${wallet.config.bankroll >= wallet.config.initialBankroll ? '‚úÖ' : '‚ùå'} 
                            ${((wallet.config.bankroll / wallet.config.initialBankroll - 1) * 100).toFixed(1)}% do inicial
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">üíµ Saldo Dispon√≠vel</div>
                        <div class="card-value">R$ ${wallet.config.availableBalance.toFixed(2)}</div>
                        <div class="card-subtitle">${((wallet.config.availableBalance / wallet.config.bankroll) * 100).toFixed(1)}% da carteira</div>
                    </div>
                    <div class="card">
                        <div class="card-title">üéÅ Saldo B√¥nus</div>
                        <div class="card-value purple">R$ ${wallet.config.bonusBalance.toFixed(2)}</div>
                        <div class="card-subtitle">Convers√≠vel em apostas</div>
                    </div>
                    <div class="card">
                        <div class="card-title">‚è≥ Valor Investido</div>
                        <div class="card-value warning">R$ ${financials.invested.toFixed(2)}</div>
                        <div class="card-subtitle">${((financials.invested / wallet.config.bankroll) * 100).toFixed(1)}% investido</div>
                    </div>
                    <div class="card">
                        <div class="card-title">üìà Lucro Total</div>
                        <div class="card-value success">R$ ${financials.totalProfit.toFixed(2)}</div>
                        <div class="card-subtitle">${financials.profitCount} vit√≥ria(s)</div>
                    </div>
                    <div class="card">
                        <div class="card-title">üéØ Win Rate</div>
                        <div class="card-value">${analysis ? analysis.actualWinRate.toFixed(1) : 0}%</div>
                        <div class="card-subtitle">${analysis ? analysis.totalBets + ' apostas' : 'Sem hist√≥rico'}</div>
                    </div>
                </div>

                <!-- Transa√ß√µes Recentes -->
                <div class="section">
                    <div class="section-title">üí∏ Transa√ß√µes Recentes</div>
                    <div class="card">
                        ${wallet.transactions.length > 0 ? `
                            ${wallet.transactions.slice(-5).reverse().map(t => `
                                <div class="transaction-item">
                                    <div class="transaction-info">
                                        <div class="transaction-type">${t.type === 'deposit' ? 'üíµ Dep√≥sito' : 'üí∏ Saque'}</div>
                                        <div style="font-size: 12px; color: #999;">${t.note}</div>
                                        <div class="transaction-date">${new Date(t.timestamp).toLocaleString('pt-BR')}</div>
                                    </div>
                                    <div class="transaction-amount ${t.type === 'deposit' ? 'success' : 'danger'}">
                                        ${t.type === 'deposit' ? '+' : '-'} R$ ${t.amount.toFixed(2)}
                                    </div>
                                </div>
                            `).join('')}
                        ` : '<div class="empty-state">Nenhuma transa√ß√£o ainda</div>'}
                    </div>
                </div>

                <!-- Gerenciar B√¥nus -->
                <div class="section">
                    <div class="section-title">üéÅ Gerenciar B√¥nus</div>
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 14px; color: #999; margin-bottom: 5px;">SALDO DE B√îNUS DISPON√çVEL</div>
                                <div style="font-size: 28px; font-weight: 700; color: #9333ea;">R$ ${wallet.config.bonusBalance.toFixed(2)}</div>
                            </div>
                            <button class="btn btn-purple" onclick="openBonusModal()">‚ûï Adicionar B√¥nus</button>
                        </div>
                        <div class="alert alert-info" style="font-size: 12px;">
                            ‚ÑπÔ∏è Ao fazer apostas, voc√™ pode selecionar se est√° usando saldo normal ou b√¥nus. 
                            Apostas com b√¥nus ser√£o marcadas especialmente no hist√≥rico.
                        </div>
                    </div>
                </div>

                <!-- Apostas -->
                <div class="section">
                    <div class="section-title">üìÖ Suas Apostas</div>
                    <div class="tabs" id="betTabs"></div>
                    <div class="card" id="betContent"></div>
                </div>
            `;
            
            renderBettingTabs();
        }

        // ============================================
        // BONUS SYSTEM
        // ============================================

        function openBonusModal() {
            const html = `
                <div class="modal active" id="tempBonusModal">
                    <div class="modal-content">
                        <div class="modal-title">üéÅ Adicionar Saldo de B√¥nus</div>
                        <div class="form-group">
                            <label>Valor do B√¥nus (R$)</label>
                            <input type="number" id="bonusAmount" step="0.01" min="1" placeholder="100.00">
                        </div>
                        <div class="form-group">
                            <label>Origem do B√¥nus (opcional)</label>
                            <input type="text" id="bonusNote" placeholder="Ex: B√¥nus de boas-vindas, Cashback...">
                        </div>
                        <div class="alert alert-warning" style="font-size: 12px;">
                            ‚ö†Ô∏è B√¥nus s√£o valores promocionais que n√£o entraram como dep√≥sito real. 
                            Use para marcar apostas feitas com cr√©ditos promocionais das casas.
                        </div>
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeBonusModal()">Cancelar</button>
                            <button class="btn btn-purple" onclick="confirmBonus()">Adicionar</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }

        function closeBonusModal() {
            document.getElementById('tempBonusModal')?.remove();
        }

        function confirmBonus() {
            const amount = parseFloat(document.getElementById('bonusAmount').value);
            const note = document.getElementById('bonusNote').value.trim();

            if (isNaN(amount) || amount <= 0) {
                alert('‚ö†Ô∏è Digite um valor v√°lido!');
                return;
            }

            const wallet = getCurrentWallet();
            wallet.config.bonusBalance += amount;

            wallet.transactions.push({
                type: 'bonus',
                amount: amount,
                note: note || 'B√¥nus adicionado',
                timestamp: new Date().toISOString()
            });

            closeBonusModal();
            saveData();
            renderApp();
            alert(`‚úÖ B√¥nus de R$ ${amount.toFixed(2)} adicionado!`);
        }

        // ============================================
        // BETTING SYSTEM
        // ============================================

        function renderBettingTabs() {
            const wallet = getCurrentWallet();
            if (!wallet) return;

            const dates = Object.keys(wallet.bettingData).sort().reverse();
            const today = getToday();
            
            if (!dates.includes(today)) {
                dates.unshift(today);
                wallet.bettingData[today] = { entries: [] };
            }
            
            const tabsContainer = document.getElementById('betTabs');
            tabsContainer.innerHTML = dates.map((date, index) => {
                const isActive = index === 0;
                const label = date === today ? 'üìÖ Hoje' : formatDate(date);
                
                return `
                    <div class="tab ${isActive ? 'active' : ''}" onclick="switchBetTab('${date}')">
                        ${label}
                    </div>
                `;
            }).join('');
            
            if (dates.length > 0) {
                renderBetContent(dates[0]);
            }
        }

        function switchBetTab(date) {
            currentTab = date;
            document.querySelectorAll('#betTabs .tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderBetContent(date);
        }

        function renderBetContent(date) {
            currentTab = date;
            const wallet = getCurrentWallet();
            if (!wallet.bettingData[date]) {
                wallet.bettingData[date] = { entries: [] };
            }
            
            const day = wallet.bettingData[date];
            const maxBets = getMaxBetsForDay(date);
            const canBet = day.entries.length < maxBets && 
                          (wallet.config.availableBalance > 0 || wallet.config.bonusBalance > 0);
            
            const contentContainer = document.getElementById('betContent');
            
            let formSection = '';
            if (canBet) {
                const suggestions = generateAISuggestions(wallet);
                
                formSection = `
                    <div style="background: rgba(0, 227, 150, 0.05); border: 1px solid rgba(0, 227, 150, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #00E396;">‚ûï Nova Aposta - ${formatDate(date)}</h3>
                        <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                            Apostas hoje: ${day.entries.length}/${maxBets} | 
                            Saldo Normal: R$ ${wallet.config.availableBalance.toFixed(2)} | 
                            B√¥nus: R$ ${wallet.config.bonusBalance.toFixed(2)}
                        </p>
                        
                        <!-- Suggestion Box -->
                        <div style="background: rgba(245, 179, 66, 0.1); border: 2px dashed rgba(245, 179, 66, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                            <div style="font-size: 12px; font-weight: 600; color: #F5B342; margin-bottom: 10px;">üí° SUGEST√ÉO DO SISTEMA</div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; font-size: 13px;">
                                <div><span style="color: #999;">Stake:</span> <strong style="color: #F5B342;">R$ ${suggestions.stake.toFixed(2)}</strong></div>
                                <div><span style="color: #999;">Odd:</span> <strong style="color: #F5B342;">${suggestions.idealOdd}</strong></div>
                                <div><span style="color: #999;">Faixa:</span> <strong style="color: #F5B342;">${suggestions.minOdd}-${suggestions.maxOdd}</strong></div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Descri√ß√£o</label>
                                <input type="text" id="entryDesc" placeholder="Ex: Flamengo vs Palmeiras - Flamengo vence">
                            </div>
                            <div class="form-group">
                                <label>Odd</label>
                                <input type="number" id="entryOdd" step="0.01" placeholder="${suggestions.idealOdd}">
                            </div>
                            <div class="form-group">
                                <label>Valor (R$)</label>
                                <input type="number" id="entryStake" step="0.01" value="${suggestions.stake.toFixed(2)}">
                            </div>
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="useBonus" onchange="toggleBonusUsage()">
                            <label for="useBonus" style="text-transform: none; color: #9333ea; font-weight: 600;">
                                üéÅ Usar Saldo de B√¥nus (Dispon√≠vel: R$ ${wallet.config.bonusBalance.toFixed(2)})
                            </label>
                        </div>
                        
                        <button class="btn" onclick="addEntry()" style="margin-top: 15px;">Adicionar Aposta</button>
                    </div>
                `;
            } else {
                const reason = wallet.config.availableBalance <= 0 && wallet.config.bonusBalance <= 0 ? 
                    'Saldo insuficiente. Fa√ßa um dep√≥sito ou aguarde resultados.' :
                    `Limite di√°rio atingido (${maxBets} apostas). Aguarde at√© amanh√£.`;
                
                formSection = `
                    <div style="background: rgba(255, 69, 96, 0.05); border: 1px solid rgba(255, 69, 96, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 10px; color: #FF4560;">üö´ Limite Atingido</h3>
                        <p style="font-size: 14px; color: #999;">${reason}</p>
                    </div>
                `;
            }
            
            let tableSection = '';
            if (day.entries.length === 0) {
                tableSection = `<div class="empty-state">
                    <div style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;">üìã</div>
                    <p>Nenhuma aposta registrada neste dia.</p>
                </div>`;
            } else {
                tableSection = `
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Odd</th>
                                <th>Valor</th>
                                <th>Retorno</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${day.entries.map((entry, index) => {
                                let statusClass = 'pending';
                                let statusText = '‚è≥ Pendente';
                                
                                if (entry.result === 'win') {
                                    statusClass = 'win';
                                    statusText = '‚úÖ Ganhou';
                                } else if (entry.result === 'loss') {
                                    statusClass = 'loss';
                                    statusText = '‚ùå Perdeu';
                                } else if (entry.result === 'cashout-win') {
                                    statusClass = 'cashout';
                                    statusText = `üí∞ Cashout ‚úÖ (R$ ${entry.cashoutAmount.toFixed(2)})`;
                                } else if (entry.result === 'cashout-loss') {
                                    statusClass = 'cashout';
                                    statusText = `üí∞ Cashout ‚ùå (R$ ${entry.cashoutAmount.toFixed(2)})`;
                                }
                                
                                const bonusBadge = entry.usedBonus ? '<span class="badge badge-bonus">üéÅ B√îNUS</span>' : '';
                                
                                return `
                                    <tr>
                                        <td><strong>${entry.description}</strong> ${bonusBadge}</td>
                                        <td>${entry.odd.toFixed(2)}</td>
                                        <td>R$ ${entry.stake.toFixed(2)}</td>
                                        <td>R$ ${entry.potentialReturn.toFixed(2)}</td>
                                        <td><span class="badge badge-${statusClass}">${statusText}</span></td>
                                        <td>
                                            <div style="display: flex; gap: 8px;">
                                                ${entry.result === 'pending' ? `
                                                    <button class="btn btn-success" onclick="markResult(${index}, 'win')">‚úÖ</button>
                                                    <button class="btn btn-danger" onclick="markResult(${index}, 'loss')">‚ùå</button>
                                                    <button class="btn btn-warning" onclick="openCashoutModal(${index})">üí∞</button>
                                                ` : ''}
                                                <button class="btn btn-secondary" onclick="deleteEntry(${index})">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            contentContainer.innerHTML = formSection + tableSection;
        }

        function toggleBonusUsage() {
            const useBonus = document.getElementById('useBonus').checked;
            const wallet = getCurrentWallet();
            const stakeInput = document.getElementById('entryStake');
            
            if (useBonus) {
                // Limitar ao saldo de b√¥nus dispon√≠vel
                if (parseFloat(stakeInput.value) > wallet.config.bonusBalance) {
                    stakeInput.value = wallet.config.bonusBalance.toFixed(2);
                }
            }
        }

        function generateAISuggestions(wallet) {
            const analysis = analyzePerformance(wallet);
            const strategy = strategies[wallet.config.strategy];
            const today = getToday();
            
            let useWinRate = wallet.config.estimatedWinRate;
            if (analysis && analysis.totalBets >= 20) {
                useWinRate = analysis.actualWinRate;
            } else if (analysis && analysis.totalBets >= 10) {
                useWinRate = (wallet.config.estimatedWinRate * 0.6) + (analysis.actualWinRate * 0.4);
            }

            const p = useWinRate / 100;
            const minOdd = 1 / p;
            const idealOdd = minOdd * 1.15;
            const maxOdd = minOdd * 1.35;

            let maxBetsToday = getMaxBetsForDay(today);

            let suggestions = {
                stake: null,
                minOdd: minOdd.toFixed(2),
                idealOdd: idealOdd.toFixed(2),
                maxOdd: maxOdd.toFixed(2),
                maxBetsToday: maxBetsToday,
                useWinRate: useWinRate
            };

            const testOdd = parseFloat(idealOdd);
            suggestions.stake = strategy.calculate(
                wallet.config.availableBalance,
                testOdd,
                useWinRate,
                wallet.config.fibonacciIndex
            );

            suggestions.stake = Math.min(suggestions.stake, wallet.config.availableBalance * 0.10);
            suggestions.stake = Math.min(suggestions.stake, wallet.config.availableBalance);

            return suggestions;
        }

        function addEntry() {
            const wallet = getCurrentWallet();
            const desc = document.getElementById('entryDesc').value.trim();
            const odd = parseFloat(document.getElementById('entryOdd').value);
            const stake = parseFloat(document.getElementById('entryStake').value);
            const useBonus = document.getElementById('useBonus')?.checked || false;
            
            if (!desc || !odd || !stake) {
                alert('‚ö†Ô∏è Preencha todos os campos!');
                return;
            }

            if (isNaN(odd) || isNaN(stake)) {
                alert('‚ö†Ô∏è Odd e valor devem ser n√∫meros v√°lidos!');
                return;
            }

            // Validar saldo
            if (useBonus) {
                if (stake > wallet.config.bonusBalance) {
                    alert(`‚ùå Saldo de b√¥nus insuficiente! Dispon√≠vel: R$ ${wallet.config.bonusBalance.toFixed(2)}`);
                    return;
                }
            } else {
                if (stake > wallet.config.availableBalance) {
                    alert(`‚ùå Saldo insuficiente! Dispon√≠vel: R$ ${wallet.config.availableBalance.toFixed(2)}`);
                    return;
                }
            }

            if (stake <= 0 || odd < 1.01) {
                alert('‚ö†Ô∏è Valores inv√°lidos!');
                return;
            }
            
            const entry = {
                description: desc,
                odd: odd,
                stake: stake,
                potentialReturn: stake * odd,
                result: 'pending',
                usedBonus: useBonus,
                timestamp: new Date().toISOString(),
                strategy: wallet.config.strategy
            };
            
            // Descontar do saldo apropriado
            if (useBonus) {
                wallet.config.bonusBalance -= stake;
            } else {
                wallet.config.availableBalance -= stake;
            }
            
            wallet.bettingData[currentTab].entries.push(entry);
            
            saveData();
            renderBetContent(currentTab);
            renderApp();
            
            document.getElementById('entryDesc').value = '';
            document.getElementById('entryOdd').value = '';
            if (document.getElementById('useBonus')) {
                document.getElementById('useBonus').checked = false;
            }
        }

        function markResult(index, result) {
            const wallet = getCurrentWallet();
            const entry = wallet.bettingData[currentTab].entries[index];
            
            if (entry.result !== 'pending') {
                alert('‚ö†Ô∏è Esta aposta j√° foi finalizada!');
                return;
            }
            
            entry.result = result;
            entry.settledAt = new Date().toISOString();
            
            if (result === 'win') {
                // Se foi aposta com b√¥nus, retorno vai pro saldo normal (convers√£o)
                if (entry.usedBonus) {
                    wallet.config.availableBalance += entry.potentialReturn;
                    wallet.config.bankroll += entry.potentialReturn; // Lucro total do b√¥nus
                } else {
                    wallet.config.availableBalance += entry.potentialReturn;
                    wallet.config.bankroll += (entry.potentialReturn - entry.stake);
                }
            } else {
                // Perda: apenas atualiza bankroll se n√£o foi b√¥nus
                if (!entry.usedBonus) {
                    wallet.config.bankroll -= entry.stake;
                }
                // Se foi b√¥nus, n√£o afeta bankroll (j√° era b√¥nus)
            }
            
            saveData();
            renderApp();
            
            const message = result === 'win' ?
                `üéâ VIT√ìRIA!\n\n${entry.usedBonus ? 'üéÅ B√¥nus convertido!\n' : ''}Lucro: +R$ ${(entry.potentialReturn - entry.stake).toFixed(2)}` :
                `‚ùå DERROTA!\n\n${entry.usedBonus ? 'B√¥nus perdido' : 'Preju√≠zo: -R$ ' + entry.stake.toFixed(2)}`;
            
            alert(message);
        }

        function openCashoutModal(index) {
            currentCashoutBetIndex = index;
            const wallet = getCurrentWallet();
            const entry = wallet.bettingData[currentTab].entries[index];
            
            const html = `
                <div class="modal active" id="tempCashoutModal">
                    <div class="modal-content">
                        <div class="modal-title">üí∞ Cashout</div>
                        <div class="form-group">
                            <label>Resultado</label>
                            <select id="cashoutResult">
                                <option value="win">‚úÖ Ganhou</option>
                                <option value="loss">‚ùå Perdeu</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valor Recebido (R$)</label>
                            <input type="number" id="cashoutAmount" step="0.01" min="0" value="${entry.stake.toFixed(2)}">
                        </div>
                        ${entry.usedBonus ? '<div class="alert alert-info">üéÅ Esta aposta foi feita com b√¥nus</div>' : ''}
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeTempCashoutModal()">Cancelar</button>
                            <button class="btn" onclick="confirmCashout()">Confirmar</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }

        function closeTempCashoutModal() {
            document.getElementById('tempCashoutModal')?.remove();
            currentCashoutBetIndex = null;
        }

        function confirmCashout() {
            if (currentCashoutBetIndex === null) return;
            
            const wallet = getCurrentWallet();
            const entry = wallet.bettingData[currentTab].entries[currentCashoutBetIndex];
            const result = document.getElementById('cashoutResult').value;
            const amount = parseFloat(document.getElementById('cashoutAmount').value);
            
            if (isNaN(amount) || amount < 0) {
                alert('‚ö†Ô∏è Valor inv√°lido!');
                return;
            }
            
            entry.result = result === 'win' ? 'cashout-win' : 'cashout-loss';
            entry.cashoutAmount = amount;
            entry.settledAt = new Date().toISOString();
            
            wallet.config.availableBalance += amount;
            
            if (result === 'win') {
                const profit = amount - entry.stake;
                if (!entry.usedBonus) {
                    wallet.config.bankroll += profit;
                } else {
                    wallet.config.bankroll += amount; // Todo o cashout √© lucro quando √© b√¥nus
                }
            } else {
                const loss = entry.stake - amount;
                if (!entry.usedBonus) {
                    wallet.config.bankroll -= loss;
                }
            }
            
            closeTempCashoutModal();
            saveData();
            renderApp();
            
            alert(`üí∞ Cashout confirmado! Recebido: R$ ${amount.toFixed(2)}`);
        }

        function deleteEntry(index) {
            if (!confirm('üóëÔ∏è Tem certeza que deseja deletar esta aposta?')) return;
            
            const wallet = getCurrentWallet();
            const entry = wallet.bettingData[currentTab].entries[index];
            
            // Reembolsar se pendente
            if (entry.result === 'pending') {
                if (entry.usedBonus) {
                    wallet.config.bonusBalance += entry.stake;
                } else {
                    wallet.config.availableBalance += entry.stake;
                }
            } else if (entry.result === 'win') {
                wallet.config.availableBalance -= entry.potentialReturn;
                if (!entry.usedBonus) {
                    wallet.config.bankroll -= (entry.potentialReturn - entry.stake);
                } else {
                    wallet.config.bankroll -= entry.potentialReturn;
                }
            } else if (entry.result === 'loss') {
                if (!entry.usedBonus) {
                    wallet.config.bankroll += entry.stake;
                }
            }
            
            wallet.bettingData[currentTab].entries.splice(index, 1);
            
            saveData();
            renderApp();
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function getToday() {
            return new Date().toISOString().split('T')[0];
        }

        function formatDate(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        }

        // ============================================
        // CONFIG MODAL
        // ============================================

        function openConfigModal() {
            if (appState.currentView === 'dashboard') {
                alert('‚ö†Ô∏è Selecione uma carteira espec√≠fica para configurar.');
                return;
            }
            
            const wallet = getCurrentWallet();
            document.getElementById('configWalletName').value = wallet.name;
            document.getElementById('configWinRate').value = wallet.config.estimatedWinRate;
            document.getElementById('configAutoStrategy').checked = wallet.config.autoStrategy;
            document.getElementById('configStrategy').value = wallet.config.strategy;
            
            document.getElementById('manualStrategyGroup').style.display = 
                wallet.config.autoStrategy ? 'none' : 'block';
            
            document.getElementById('configModal').classList.add('active');
        }

        function closeConfigModal() {
            document.getElementById('configModal').classList.remove('active');
        }

        function toggleAutoStrategy() {
            const wallet = getCurrentWallet();
            wallet.config.autoStrategy = document.getElementById('configAutoStrategy').checked;
            
            document.getElementById('manualStrategyGroup').style.display = 
                wallet.config.autoStrategy ? 'none' : 'block';
        }

        function updateConfig() {
            const wallet = getCurrentWallet();
            const newName = document.getElementById('configWalletName').value.trim();
            const newWinRate = parseInt(document.getElementById('configWinRate').value);
            const newStrategy = document.getElementById('configStrategy').value;

            if (!newName) {
                alert('‚ö†Ô∏è Digite um nome para a carteira!');
                return;
            }

            if (isNaN(newWinRate) || newWinRate < 30 || newWinRate > 80) {
                alert('‚ö†Ô∏è Win rate deve estar entre 30% e 80%!');
                return;
            }

            wallet.name = newName;
            wallet.config.estimatedWinRate = newWinRate;
            
            if (!wallet.config.autoStrategy) {
                wallet.config.strategy = newStrategy;
            }

            closeConfigModal();
            saveData();
            renderApp();
            alert('‚úÖ Configura√ß√µes salvas!');
        }

        // ============================================
        // IMPORT/EXPORT
        // ============================================

        function openImportModal() {
            document.getElementById('importData').value = '';
            document.getElementById('importModal').classList.add('active');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        function importData() {
            try {
                const jsonStr = document.getElementById('importData').value.trim();
                
                if (!jsonStr) {
                    alert('‚ö†Ô∏è Cole o JSON do backup!');
                    return;
                }
                
                const data = JSON.parse(jsonStr);
                
                if (!data.wallets) {
                    alert('‚ùå Formato inv√°lido!');
                    return;
                }
                
                if (!confirm('‚ö†Ô∏è Isso vai SUBSTITUIR todos os dados atuais. Continuar?')) {
                    return;
                }
                
                appState = data;
                
                saveData();
                renderApp();
                closeImportModal();
                
                alert('‚úÖ Dados importados com sucesso!');
                
            } catch (e) {
                console.error('Erro ao importar:', e);
                alert('‚ùå Erro ao importar: ' + e.message);
            }
        }

        function exportData() {
            const data = {
                ...appState,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `criteryon-v6-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Backup exportado!');
        }

        // ============================================
        // PERSISTENCE
        // ============================================

        function saveData() {
            try {
                localStorage.setItem('criteryon_v6', JSON.stringify(appState));
                console.log('[SAVE] Dados salvos');
                return true;
            } catch (e) {
                console.error('[SAVE ERROR]', e);
                return false;
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('criteryon_v6');
                
                if (saved) {
                    appState = JSON.parse(saved);
                    console.log('[LOAD] Dados carregados');
                } else {
                    createDefaultWallet();
                    appState.currentView = 'dashboard';
                }
                
                renderApp();
                return true;
            } catch (e) {
                console.error('[LOAD ERROR]', e);
                createDefaultWallet();
                renderApp();
                return false;
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        window.onload = function() {
            console.log('[INIT] Criteryon v6.0 - Multi-Wallet');
            loadData();
            
            setInterval(() => saveData(), 30000);
            
            window.addEventListener('beforeunload', () => saveData());
            
            console.log('[INIT] Sistema iniciado!');
        };
    </script>
</body>
</html>
